###############################################
#
# Now available: developmental python x3d.py package on PyPi for import.
#   This approach greatly simplifies Python X3D deployment and use.
#   https://pypi.org/project/x3d
#
# Installation:
#       pip install x3d
# or
#       python -m pip install x3d
#
# Developer options for loading x3d package:
#
#    from x3d import *  # preferred approach, terser source that avoids x3d.* class prefixes
#
# or
#    import x3d         # traditional way to subclass x3d package, all classes require x3d.* prefix
#                       # but python source is very verbose, for example x3d.Material x3d.Shape etc.
#                       # X3dToPython.xslt stylesheet insertPackagePrefix=true supports this option.

from x3d import *

###############################################

newModel=X3D(profile='Immersive',version='3.0',
  head=head(
    children=[
    meta(content='Remus01PositionInterpolator.x3d',name='title'),
    meta(content='Autogenerated AUV mission from the actual data collected during exercise KB01.',name='description'),
    meta(content='Don Brutzman',name='creator'),
    meta(content='AuvDataServer (ADS)',name='generator'),
    meta(content='10 June 2001',name='created'),
    meta(content='21 October 2018',name='modified'),
    meta(content='https://savage.nps.edu/Savage/Scenarios/AmphibiousRaidCampPendleton/Remus01PositionInterpolator.x3d',name='identifier'),
    meta(content='X3D-Edit 3.2, https://savage.nps.edu/X3D-Edit',name='generator'),
    meta(content='../../license.html',name='license')]),
  Scene=Scene(
    children=[
    ExternProtoDeclare(appinfo='Reads waypoints and legSpeeds/legDurations/defaultSpeed to provide a customizable position/orientation interpolator.',name='WaypointInterpolator',url=["../../../Savage/Tools/Animation/WaypointInterpolatorPrototype.x3d#WaypointInterpolator","https://savage.nps.edu/Savage/Tools/Animation/WaypointInterpolatorPrototype.x3d#WaypointInterpolator","../../../Savage/Tools/Animation/WaypointInterpolatorPrototype.wrl#WaypointInterpolator","https://savage.nps.edu/Savage/Tools/Animation/WaypointInterpolatorPrototype.wrl#WaypointInterpolator"],
      #  Priority of use: legSpeeds (m/sec), legDurations (seconds), defaultSpeed (m/sec) 
      field=[
      field(accessType='initializeOnly',appinfo='Short description of what is animated by this WaypointInterpolator.',name='description',type='SFString'),
      field(accessType='initializeOnly',appinfo='Waypoints being traversed with interpolation of intermediate positions and orientations.',name='waypoints',type='MFVec3f'),
      field(accessType='inputOnly',appinfo='Add another single waypoint to array of waypoints recalculate interpolator values.',name='add_waypoint',type='SFVec3f'),
      field(accessType='inputOnly',appinfo='Replace all waypoints recalculate interpolator values.',name='set_waypoints',type='MFVec3f'),
      field(accessType='initializeOnly',appinfo='Whether to pitch child geometry (such as a vehicle) up or down to match vertical slope',name='pitchUpDownForVerticalWaypoints',type='SFBool'),
      field(accessType='initializeOnly',appinfo='Units m/sec. If used array lengths for legSpeeds and legDurations must be one less than number of waypoints.',name='legSpeeds',type='MFFloat'),
      field(accessType='initializeOnly',appinfo='Units in seconds. If used array lengths for legSpeeds and legDurations must be one less than number of waypoints.',name='legDurations',type='MFFloat'),
      field(accessType='initializeOnly',appinfo='Units m/sec.',name='defaultSpeed',type='SFFloat'),
      field(accessType='initializeOnly',appinfo='turningRate (degrees/second) also determines standoff distance prior to waypoint where turn commences. If 0 turns are instantaneous.',name='turningRate',type='SFFloat'),
      field(accessType='outputOnly',appinfo='Output calculation summing all leg durations, useful for setting TimeSensor cycleInterval. Units in seconds.',name='totalDuration',type='SFTime'),
      #  interpolation fields 
      field(accessType='inputOnly',appinfo='exposed PositionInterpolator and OrientationInterpolator setting',name='set_fraction',type='SFFloat'),
      field(accessType='outputOnly',appinfo='exposed PositionInterpolator setting',name='position_changed',type='SFVec3f'),
      field(accessType='outputOnly',appinfo='exposed OrientationInterpolator setting',name='orientation_changed',type='SFRotation'),
      #  display-related fields 
      field(accessType='inputOutput',appinfo='default color for non-active line segments',name='lineColor',type='SFColor'),
      field(accessType='inputOutput',appinfo='active segment highlight color',name='highlightSegmentColor',type='SFColor'),
      field(accessType='inputOutput',appinfo='1.0 is completely transparent, 0.0 is completely opaque.',name='transparency',type='SFFloat'),
      field(accessType='initializeOnly',appinfo='allowed values: none; waypoints (produce labels at each waypoint); or interpolation (produce single moving label at interpolator time course speed location)',name='labelDisplayMode',type='SFString'),
      field(accessType='initializeOnly',appinfo='allowed values: altitude depth (negate Y value) none',name='heightLabel',type='SFString'),
      field(accessType='initializeOnly',appinfo='heightLabel relative location',name='labelOffset',type='SFVec3f'),
      field(accessType='initializeOnly',appinfo='heightLabel text size',name='labelFontSize',type='SFFloat'),
      field(accessType='initializeOnly',appinfo='heightLabel text color',name='labelColor',type='SFColor'),
      field(accessType='initializeOnly',appinfo='enable console output to trace script computations and prototype progress',name='traceEnabled',type='SFBool'),
      field(accessType='initializeOnly',appinfo='Output the number of waypoints totalDistance and totalDuration to console upon initialization',name='outputInitializationComputations',type='SFBool'),
      field(accessType='inputOutput',appinfo='default color for vertical drop-line segments',name='verticalDropLineColor',type='SFColor'),
      field(accessType='inputOutput',appinfo='1.0 is completely transparent, 0.0 is completely opaque.',name='verticalDropLineTransparency',type='SFFloat')]),
    #  ====================================== 
    ExternProtoDeclare(name='HiddenViewpoint',url=["../../../Savage/Tools/Animation/HiddenViewpointPrototype.wrl#HiddenViewpoint","https://savage.nps.edu/Savage/Environment/Tools/Animation/HiddenViewpointPrototype.wrl#HiddenViewpoint","../../../Savage/Tools/Animation/HiddenViewpointPrototype.x3d#HiddenViewpoint","https://savage.nps.edu/Savage/Environment/Tools/Animation/HiddenViewpointPrototype.x3d#HiddenViewpoint"],
      field=[
      field(accessType='inputOutput',name='position',type='SFVec3f'),
      field(accessType='inputOutput',name='rotation',type='SFRotation'),
      field(accessType='initializeOnly',name='sensorRadius',type='SFFloat'),
      field(accessType='inputOnly',name='activate',type='SFBool'),
      field(accessType='inputOutput',name='label',type='MFString'),
      field(accessType='inputOutput',name='labelOffset',type='SFVec3f'),
      field(accessType='initializeOnly',name='labelFontSize',type='SFFloat'),
      field(accessType='inputOutput',name='labelColor',type='SFColor')]),
    #  ====================================== 
    #  Example instance follows prototype declaration 
    Viewpoint(description='Remus01PositionInterpolator',orientation=(1,0,0,-0.3),position=(0,0,0)),
    Viewpoint(description='Above, looking down',orientation=(1,0,0,-1.57),position=(0,5000,0)),
    #  Reduce aliasing by increasing relative precision 
    NavigationInfo(visibilityLimit=20000),
    WorldInfo(title='AUV exercise KB01'),
    Inline(DEF='CoordinateAxes',url=["../../Tools/Authoring/CoordinateAxes.x3d","../../X3dForWebAuthors/Chapter03Grouping/CoordinateAxes.x3d","https://savage.nps.edu/Savage/Tools/Authoring/CoordinateAxes.x3d","http://X3dGraphics.com/examples/X3dForWebAuthors/Chapter03Grouping/CoordinateAxes.x3d","../../Tools/Authoring/CoordinateAxes.wrl","../../X3dForWebAuthors/Chapter03Grouping/CoordinateAxes.wrl","https://savage.nps.edu/Savage/Tools/Authoring/CoordinateAxes.wrl","http://X3dGraphics.com/examples/X3dForWebAuthors/Chapter03Grouping/CoordinateAxes.wrl"]),
    TimeSensor(DEF='Clock',cycleInterval=4.0,loop=True),
    ProtoInstance(DEF='TrackPosition',name='WaypointInterpolator',
      #  XZ coordinates are converted from Lat/Long based on the origin 
      #  The origin is the first data point 
      fieldValue=[
      fieldValue(name='description',value='TrackPosition'),
      fieldValue(name='waypoints',value=[(0.0,-0.121920004,0.0),(-3.8177228,-3.07848,10.638249),(-57.26584,-10.42416,251.0717),(14.8467,-10.5156,363.8412),(57.26584,-10.027921,421.28983),(183.67488,-8.9916,599.30963),(268.51315,-9.540239,714.2068),(342.74667,-8.74776,814.91925),(413.16245,-8.29056,914.21313),(485.69916,-7.5590396,1013.507),(594.7164,-6.5532,1170.9587),(698.64325,-5.3949604,1309.261),(711.7932,-5.27304,1327.7013),(824.6281,-3.26136,1483.0253),(880.1972,-1.00584,1556.7865),(804.2669,-2.5908,1480.8976),(706.2787,-5.12064,1344.7231),(609.56305,-6.49224,1211.3855),(500.54587,-7.83336,1058.1893),(415.2834,-8.44296,941.87354),(372.44006,-7.98576,883.0064),(274.45184,-8.80872,749.66895),(220.57953,-9.17448,672.3616),(98.41241,-9.7536,500.7249),(40.722374,-9.875521,426.25452),(-105.623665,-10.454639,294.33548),(-94.59468,-10.27176,314.19424),(-3.8177228,-9.41832,443.27634),(66.59805,-9.57072,539.02405),(177.7362,-9.144,690.8018),(290.9953,-8.47344,848.9628),(374.561,-8.10768,965.2785),(444.97678,-7.3152,1061.0262),(515.3926,-7.1018395,1156.0647),(624.4097,-5.3949604,1307.8425),(694.8255,-4.75488,1407.1365),(735.5479,-3.99288,1462.4573),(828.4458,-1.34112,1591.5393),(702.461,-4.38912,1441.18),(672.7676,-4.66344,1403.5902),(563.3262,-6.49224,1248.9753),(492.91043,-6.94944,1151.1001),(368.62234,-7.7114396,979.4634),(311.3565,-8.59536,903.5745),(242.63748,-8.62584,808.536),(189.18936,-8.80872,731.22864),(107.32043,-9.4488,619.8776),(22.057953,-9.47928,503.56192),(-74.2335,-9.72312,370.2244),(-150.16376,-10.08888,342.56393),(-96.29145,-9.78408,414.90662),(27.996634,-8.93064,587.25244),(94.59468,-9.50976,681.58167),(161.19273,-8.50392,770.23694),(240.94072,-8.59536,880.1695),(318.56775,-8.16864,985.1373),(448.37033,-7.13232,1168.1217),(461.52026,-6.76656,1183.7251),(556.1149,-5.3035197,1313.5165),(672.7676,-4.51104,1476.6421),(726.6399,-2.68224,1549.6941),(767.36224,-0.70103997,1620.6183),(683.7966,-2.9260802,1517.0688),(565.44714,-5.4559197,1353.9432),(470.85248,-6.79704,1224.1519),(418.6769,-7.1018395,1151.1001),(315.17422,-7.52856,1007.12384),(220.57953,-8.44296,880.1695),(168.82819,-8.59536,807.11755),(105.623665,-8.93064,717.0438),(53.87231,-9.05256,644.7011),(-86.959236,-9.235439,453.91495),(-111.13815,-9.875521,421.28983),(-174.34267,-9.47928,409.2327),(-83.565704,-9.11352,534.76855),(-31.390163,-8.96112,607.11127),(7.211254,-8.96112,663.1414),(140.83154,-8.86968,842.57965),(192.5829,-8.74776,915.63153),(261.3019,-8.74776,1016.344),(368.62234,-7.74192,1160.3201),(388.98352,-7.22376,1192.9452),(474.246,-5.6388,1306.424),(522.6038,-5.5473604,1372.3835),(654.10315,-3.7795198,1555.368),(702.461,-0.97536004,1620.6183),(711.7932,-1.03632,1651.825),(613.3808,-4.02336,1521.3243),(530.23926,-5.1816,1405.0087),(467.03473,-6.03504,1323.4458),(402.13345,-6.82752,1173.0865),(361.41107,-7.68096,1056.7708),(327.89996,-7.83336,958.8953),(281.6631,-7.83336,824.13934),(268.51315,-8.41248,785.8403),(194.70386,-8.71728,568.8122),(187.0684,-8.80872,549.66266),(146.34604,-9.387839,431.92844),(107.32043,-8.93064,316.32196),(59.3868,-9.47928,202.84323),(24.178911,-10.302239,83.69053),(0.0,-0.18288001,-1.4145588),(-61.083565,-9.235439,-4.9641376),(-61.083565,-9.4488,82.27206),(-174.34267,-9.02208,244.6885),(-251.9697,-9.35736,375.18906),(-287.17758,-9.20496,528.3854),(-231.6085,-9.02208,605.69275),(-129.80257,-8.29056,746.832),(-42.843334,-7.9552803,865.9846),(13.149934,-7.8028803,946.8382),(142.52832,-6.94944,1124.858),(215.06505,-6.88848,1226.9889),(298.20657,-6.21792,1343.3047),(381.77228,-5.0901604,1458.2019),(407.64795,-4.7244,1495.0824),(556.1149,-1.43256,1701.4719),(568.8407,-0.82296,1719.9121),(468.7315,-3.5052,1558.9142),(370.7433,-5.21208,1426.9952),(342.74667,-5.66928,1387.9868),(189.18936,-6.79704,1174.505),(133.6203,-6.858,1095.07),(92.473724,-7.28472,1038.3304),(9.3322115,-7.7114396,922.01483),(-142.52832,-8.44296,707.82367),(-157.37502,-8.6868,687.9649),(-240.94072,-9.20496,574.48615),(-318.99194,-8.9916,461.7166),(-205.73283,-8.80872,607.11127),(-122.16713,-8.65632,723.42694),(-63.20452,-7.7724,804.2806),(64.90128,-7.1628,980.88184),(162.8895,-7.2542396,1117.0564),(246.45522,-6.2484,1236.209),(330.0209,-5.57784,1353.9432),(357.59335,-5.27304,1391.5331),(511.57483,-3.7795198,1605.015),(581.9906,-1.18872,1696.5072),(604.0486,-0.94487995,1665.3005),(506.06036,-3.41376,1526.2891),(409.7689,-5.334,1394.3701),(326.2032,-6.4008,1275.2174),(281.6631,-6.52272,1216.3502),(129.80257,-7.2542396,1004.2868),(72.11254,-7.2542396,926.2702),(31.390163,-7.74192,867.40314),(-122.16713,-8.56488,655.3397),(-201.91512,-8.86968,542.57025),(-276.14862,-9.35736,427.673),(-248.15198,-9.72312,463.1351),(-137.01382,-8.6868,619.8776),(-50.054585,-8.138161,737.6118),(22.057953,-7.7114396,836.9057),(135.31706,-7.4980803,992.93896),(161.19273,-7.3152,1033.3658),(259.60513,-6.91896,1170.9587),(370.7433,-6.43128,1324.8643),(456.00577,-5.21208,1441.18),(509.4539,-3.9014401,1518.4874),(621.01624,-0.9144,1670.2653),(557.8117,-2.7432,1563.1697),(489.09268,-4.17576,1470.2589),(403.83023,-5.2425604,1353.9432),(324.50644,-6.4008,1237.6276),(239.24396,-6.58368,1122.0211),(140.83154,-7.4066396,985.1373),(46.236862,-7.8028803,855.346),(-31.390163,-8.47344,743.995),(-96.29145,-8.80872,653.92126),(-185.37164,-9.2964,531.22235),(-259.60513,-9.144,429.0915),(-183.67488,-9.05256,464.5536),(-133.6203,-9.144,537.6055),(-68.71901,-8.26008,627.67926),(61.083565,-8.77824,807.11755),(140.83154,-7.6504803,915.63153),(165.01045,-7.8638396,951.0937),(292.69208,-6.88848,1131.2412),(342.74667,-6.21792,1200.747),(405.95117,-6.52272,1289.4022),(507.7571,-4.78536,1431.2506),(585.80835,-3.87096,1534.0907),(648.5887,-1.55448,1623.4553),(656.2241,-0.79248,1619.1998),(581.9906,-3.3528,1513.5227),(491.21365,-4.9987197,1387.9868),(370.7433,-6.096,1220.6057),(305.842,-6.73608,1131.2412),(240.94072,-6.67512,1039.749),(148.467,-8.50392,912.7947),(98.41241,-7.8638396,841.16113),(-3.8177228,-8.59536,697.18506),(-72.11254,-9.11352,604.2743),(-105.623665,-8.96112,556.04584),(-168.82819,-9.41832,468.0998),(-212.94409,-9.72312,378.02606),(-181.55392,-9.235439,289.3708),(-157.37502,-9.57072,253.90868),(-74.2335,-9.78408,116.315674),(-14.8467,-9.72312,21.986317),(-7.6354456,-9.72312,7.801188)]),
      fieldValue(name='pitchUpDownForVerticalWaypoints',value=False),
      #  Priority of use: legSpeeds (m/sec), legDurations (seconds), defaultSpeed (m/sec) 
      #  If used, array lengths for legSpeeds and legDurations must be one less than number of waypoints. 
      fieldValue(name='legDurations',value=[60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,6060,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60]),
      #  turningRate (degrees/second) will also determine standoff distance prior to waypoint where turn commences. if 0, turns are instantaneous. 
      fieldValue(name='turningRate',value=90),
      fieldValue(name='lineColor',value=(1,0,0)),
      fieldValue(name='highlightSegmentColor',value=(1,1,0)),
      fieldValue(name='transparency',value=0),
      fieldValue(name='labelOffset',value=(0,-0.8,0)),
      fieldValue(name='labelFontSize',value=0.5),
      fieldValue(name='labelColor',value=(0.3,0.9,0.3)),
      fieldValue(name='traceEnabled',value=True)]),
    Transform(DEF='TrackingTransform',
      #  Always align initial geometry with X axis 
      children=[
      Group(
        #  Point vehicle along X-axis 
        children=[
        Transform(
          children=[
          Inline(url=["../../Robots/UnmannedUnderwaterVehicles/RemusSideScan.x3d","https://savage.nps.edu/Savage/Robots/UnmannedUnderwaterVehicles/RemusSideScan.x3d","../../Robots/UnmannedUnderwaterVehicles/RemusSideScan.wrl","https://savage.nps.edu/Savage/Robots/UnmannedUnderwaterVehicles/RemusSideScan.wrl"])]),
        Viewpoint(description='Ride on',orientation=(0,1,0,-1.57),position=(-4,1,0)),
        Viewpoint(description='Ride alongside',position=(0,0,5)),
        Viewpoint(description='Ride in front',orientation=(0,1,0,1.57),position=(4,1,0))])]),
    ROUTE(fromField='fraction_changed',fromNode='Clock',toField='set_fraction',toNode='TrackPosition'),
    ROUTE(fromField='totalDuration',fromNode='TrackPosition',toField='cycleInterval',toNode='Clock'),
    ROUTE(fromField='position_changed',fromNode='TrackPosition',toField='translation',toNode='TrackingTransform'),
    ROUTE(fromField='orientation_changed',fromNode='TrackPosition',toField='rotation',toNode='TrackingTransform')])
) # X3D model complete

###############################################
# Self-test diagnostics
###############################################

if        metaDiagnostics(newModel): # built-in utility method in X3D class
    print(metaDiagnostics(newModel))
print('check  newModel.XML() serialization...')
newModelXML = newModel.XML() # test export method XML() for exceptions
# print(newModelXML) # debug

print ("python x3d.py load successful for Remus01PositionInterpolator.py")
