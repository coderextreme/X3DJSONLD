#VRML V2.0 utf8

Group {
  children	[
    WorldInfo {
      info	[ "Created in CosmoWorlds",
	        "Packaged by CosmoPackage",
	        "Packaged by CosmoPackage" ]
    }
    DEF room2walls Transform {
      children	Shape {
	appearance	Appearance {
	  material	DEF _0 Material {
	  }

	  texture	ImageTexture {
	    url	"grass.gif"
	  }

	  textureTransform	NULL

	}

	geometry	IndexedFaceSet {
	  coord	Coordinate {
	    point	[ -2.25542 1.47408 1,
		      -2.25542 -1 1,
		      1.52662 1.47408 1,
		      1.52662 -1 1,
		      1.52662 1.47408 -2.82608,
		      1.52662 -1 -2.82608,
		      -2.25542 1.47408 -2.82608,
		      -2.25542 -1 -2.82608,
		      0 -1 1,
		      0 1.47408 1,
		      -0.5 -1 1,
		      -0.5 1.47408 1,
		      0.5 1.47408 1,
		      0.5 -1 1,
		      0 -1 1.43085,
		      -0.5 -1 1.43085,
		      0 1 1.43085,
		      -0.5 1 1.43085,
		      0.5 -1 1.43085,
		      0.5 1 1.43085,
		      -2.25542 0.768432 -2.82608,
		      1.52662 0.768417 -2.82608,
		      -1.67762 -1 -2.82608,
		      -1.67762 0.76843 -2.82608,
		      0.82272 0.76842 -2.82608,
		      0.822608 -1 -2.82608,
		      0.822614 -0.898325 -2.82608,
		      -1.67762 -0.898394 -2.82608 ]
	  }

	  color	NULL

	  coordIndex	[ 6, 20, 7, 1, 0, -1, 2, 3,
		    5, 21, 4, -1, 6, 0, 11, 9,
		    12, 2, 4, -1, 1, 7, 22, 25,
		    5, 3, 13, 8, 10, -1, 0, 1,
		    10, 11, -1, 13, 3, 2, 12, -1,
		    14, 15, 10, 8, -1, 17, 16, 9,
		    11, -1, 15, 17, 11, 10, -1, 18,
		    14, 8, 13, -1, 19, 18, 13, 12,
		    -1, 16, 19, 12, 9, -1, 4, 21,
		    24, 23, 20, 6, -1, 22, 7, 20,
		    23, 27, -1, 21, 5, 25, 26, 24,
		    -1, 25, 22, 27, 26, -1 ]
	  normal	NULL

	  texCoord	TextureCoordinate {
	    point	[ 0 1,
		      0 0,
		      1 1,
		      1 0,
		      0.5 0,
		      0.5 1,
		      0.5 1,
		      0.5 0,
		      0.25 1,
		      0.25 0,
		      0.25 0,
		      0.25 1,
		      0.75 0,
		      0.75 1,
		      0.75 1,
		      0.75 0,
		      1 0.884216,
		      0 0.884216,
		      0 0.884209,
		      1 0.884209,
		      0.152775 0,
		      0.847225 0,
		      0.847226 0.884215,
		      0.847226 0.884215,
		      0.186117 0.88421,
		      0.186117 0.88421,
		      0.813854 0,
		      0.186146 0,
		      0.186144 0.0508373,
		      0.186144 0.0508373,
		      0.847225 0.0508028,
		      0.847225 0.0508029 ]
	  }

	  texCoordIndex	[ 0, 17, 1, 3, 2, -1, 0, 1,
		    3, 19, 2, -1, 0, 1, 10, 7,
		    12, 3, 2, -1, 0, 1, 20, 26,
		    3, 2, 14, 5, 8, -1, 0, 1,
		    9, 11, -1, 15, 3, 2, 13, -1,
		    9, 4, 4, 9, -1, 11, 6, 6,
		    11, -1, 11, 0, 0, 11, -1, 15,
		    4, 4, 15, -1, 13, 15, 15, 13,
		    -1, 13, 6, 6, 13, -1, 0, 18,
		    24, 22, 16, 2, -1, 21, 3, 16,
		    23, 30, -1, 18, 1, 27, 28, 25,
		    -1, 27, 21, 31, 29, -1 ]
	  solid	FALSE
	  creaseAngle	0.5
	}

      }

      translation	-0.276271 0.149935 -4.5
    }
    DEF room1wallsAndDoor Transform {
      children	Collision {
	children	[
	  Transform {
	    children	Shape {
	      appearance	Appearance {
		material	Material {
		}

		texture	ImageTexture {
		  url	"quartz.gif"
		}

		textureTransform	TextureTransform {
		  translation	0 0
		  rotation	0
		  scale	1.70147 0.600024
		  center	0.5 0.5
		}

	      }

	      geometry	IndexedFaceSet {
		coord	Coordinate {
		  point	[ -1 1 1,
			    -1 -1 1,
			    1 1 1,
			    1 -1 1,
			    1 1 -1,
			    1 -1 -1,
			    -1 1 -1,
			    -1 -1 -1,
			    -1 0.104322 1,
			    -1 0.104347 -1,
			    -1 -0.999999 0.112777,
			    -1 0.104333 0.112781,
			    -1 0.104336 -0.127745,
			    -1 -1 -0.127742 ]
		}

		color	NULL

		coordIndex	[ 0, 8, 1, 3, 2, -1, 4, 5,
			  7, 9, 6, -1, 2, 3, 5, 4,
			  -1, 6, 0, 2, 4, -1, 1, 10,
			  13, 7, 5, 3, -1, 6, 9, 12,
			  11, 8, 0, -1, 10, 1, 8, 11,
			  -1, 9, 7, 13, 12, -1 ]
		colorIndex	-1
		normal	NULL

		texCoord	TextureCoordinate {
		  point	[ 0 1,
			    0 0,
			    1 1,
			    1 0,
			    0 0.609738,
			    1 0.609738,
			    1 0.60975,
			    0 0.60975,
			    0 0.583517,
			    0.583517 0,
			    0.583519 0.609743,
			    0.583519 0.609743,
			    0.392509 0.609745,
			    0.392509 0.609745,
			    0 0.392511,
			    0.392511 0 ]
		}

		texCoordIndex	[ 0, 4, 1, 3, 2, -1, 0, 1,
			  3, 6, 2, -1, 0, 1, 3, 2,
			  -1, 0, 1, 3, 2, -1, 0, 8,
			  14, 1, 3, 2, -1, 0, 7, 12,
			  10, 5, 2, -1, 9, 3, 5, 11,
			  -1, 7, 1, 15, 13, -1 ]
		ccw	FALSE
		solid	FALSE
		creaseAngle	0.5
	      }

	    }

	    translation	-0.27643 0.882791 0.717535
	    rotation	0 1 0  4.71239
	    scale	4.00807 1.73318 3.63627
	    scaleOrientation	0 0 1  0
	  }
	  Transform {
	    children	[
	      Group {
		children	[
		  DEF OpenPinkDoor Group {
		    children	DEF Time_1 TimeSensor {
		      cycleInterval	1.5
		      startTime	0
		    }

		  }
		  DEF UnnamedShapePointInterp CoordinateInterpolator {
		    key	[ 0, 0.2, 0.466667, 0.666667,
			      0.866667 ]
		    keyValue	[ -0.5 -1 1.43085,
			      0 1 1.43085,
			      -0.5 1 1.43085,
			      0.5 -1 1.43085,
			      0.5 1 1.43085,
			      -0.417603 1 1.43085,
			      -0.417603 -1 1.43085,
			      0.404819 1 1.43085,
			      0.404819 -1 1.43085,
			      0 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0.404819 0.857293 1.43085,
			      0 -1 1.43085,
			      -0.417603 -1 1.43085,
			      0 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0 -1 1.43085,
			      0.404819 -1 1.43085,
			      0.404819 0.857293 1.43085,
			      0 0.857293 1.43085,
			      -0.5 -1 1.43085,
			      0 1 1.43085,
			      -0.5 1 1.43085,
			      0.5 -1 1.43085,
			      0.5 1 1.43085,
			      -0.417603 1 1.43085,
			      -0.417603 -1 1.43085,
			      0.404819 1 1.43085,
			      0.404819 -1 1.43085,
			      0 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0.404819 0.857293 1.43085,
			      -0.19489 -1 1.43085,
			      -0.417603 -1 1.43085,
			      -0.19489 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0 -1 1.43085,
			      0.404819 -1 1.43085,
			      0.404819 0.857293 1.43085,
			      0 0.857293 1.43085,
			      -0.5 -1 1.43085,
			      0 1 1.43085,
			      -0.5 1 1.43085,
			      0.5 -1 1.43085,
			      0.5 1 1.43085,
			      -0.417603 1 1.43085,
			      -0.417603 -1 1.43085,
			      0.404819 1 1.43085,
			      0.404819 -1 1.43085,
			      0 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0.404819 0.857293 1.43085,
			      -0.19489 -1 1.43085,
			      -0.417603 -1 1.43085,
			      -0.19489 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0 0.0251007 1.43085,
			      0.404819 0.0251007 1.43085,
			      0.404819 0.857293 1.43085,
			      0 0.857293 1.43085,
			      -0.5 -1 1.43085,
			      0 1 1.43085,
			      -0.5 1 1.43085,
			      0.5 -1 1.43085,
			      0.5 1 1.43085,
			      -0.417603 1 1.43085,
			      -0.417603 -1 1.43085,
			      0.404819 1 1.43085,
			      0.404819 -1 1.43085,
			      0 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0.404819 0.857293 1.43085,
			      -0.408726 -1 1.43085,
			      -0.417603 -1 1.43085,
			      -0.408726 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0.271004 0.0251007 1.43085,
			      0.404819 0.0251007 1.43085,
			      0.404819 0.857293 1.43085,
			      0.271004 0.857293 1.43085,
			      -0.5 -1 1.43085,
			      0 1 1.43085,
			      -0.5 1 1.43085,
			      0.5 -1 1.43085,
			      0.5 1 1.43085,
			      -0.417603 1 1.43085,
			      -0.417603 -1 1.43085,
			      0.404819 1 1.43085,
			      0.404819 -1 1.43085,
			      0 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0.404819 0.857293 1.43085,
			      -0.408726 -1 1.43085,
			      -0.417603 -1 1.43085,
			      -0.408726 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0.271004 0.847513 1.43085,
			      0.404819 0.847513 1.43085,
			      0.404819 0.857293 1.43085,
			      0.271004 0.857293 1.43085 ]
		  }
		]
	      }
	      DEF Touch TouchSensor {
	      }
	      Shape {
		appearance	Appearance {
		  material	USE _0

		  texture	ImageTexture {
		    url	"turq.gif"
		  }

		  textureTransform	NULL

		}

		geometry	IndexedFaceSet {
		  coord	DEF _3 Coordinate {
		    point	[ -0.5 -1 1.43085,
			      0 1 1.43085,
			      -0.5 1 1.43085,
			      0.5 -1 1.43085,
			      0.5 1 1.43085,
			      -0.417603 1 1.43085,
			      -0.417603 -1 1.43085,
			      0.404819 1 1.43085,
			      0.404819 -1 1.43085,
			      0 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0.404819 0.857293 1.43085,
			      0 -1 1.43085,
			      -0.417603 -1 1.43085,
			      0 0.857293 1.43085,
			      -0.417603 0.857293 1.43085,
			      0 -1 1.43085,
			      0.404819 -1 1.43085,
			      0.404819 0.857293 1.43085,
			      0 0.857293 1.43085 ]
		  }

		  color	Color {
		    color	[ 0.8 0.562076 0.757962,
			      0.8 0 0.651839 ]
		  }

		  coordIndex	[ 0, 6, 10, 5, 2, -1, 8, 3,
			    4, 7, 11, -1, 13, 12, 14, 15,
			    -1, 9, 1, 5, 10, -1, 16, 17,
			    18, 19, -1, 11, 7, 1, 9, -1 ]
		  colorIndex	[ 1, 1, 0, 1, 0, 1 ]
		  normal	NULL

		  texCoord	TextureCoordinate {
		    point	[ 0.25 0,
			      0.6968 -0.0103069,
			      0.673916 0.992,
			      0.25 1,
			      1.08125 0.00342336,
			      1.0904 1.00115,
			      0.375 1,
			      0.390158 -0.0240371,
			      0.994288 1.00115,
			      1.0126 -0.00115335,
			      0.678493 0.895888,
			      0.678493 0.895888,
			      0.376428 0.923349,
			      0.381005 0.895888,
			      0.980558 0.905042,
			      0.998865 0.914195 ]
		  }

		  colorPerVertex	FALSE
		  texCoordIndex	[ 0, 7, 12, 6, 3, -1, 9, 4,
			    5, 8, 15, -1, 7, 1, 10, 13,
			    -1, 10, 2, 6, 13, -1, 1, 9,
			    14, 11, -1, 14, 8, 2, 11, -1 ]
		  ccw	TRUE
		  solid	FALSE
		  convex	TRUE
		  creaseAngle	0.5
		}

	      }
	    ]
	    translation	-0.276271 0.149935 -4.5
	    center	0 0 1.43085
	  }
	]
	proxy	NULL

      }

    }
    DEF puzzle1 Transform {
      children	[
	DEF Puzzle1_Script Script {
	  eventOut	  SFTime	  trigger
	  eventIn	  SFVec3f	  inPositionP
	  eventIn	  SFVec3f	  inPositionO
	  eventIn	  SFVec3f	  inPositionS1
	  eventIn	  SFVec3f	  inPositionE1
	  eventIn	  SFVec3f	  inPositionE2
	  eventIn	  SFVec3f	  inPositionM
	  eventIn	  SFVec3f	  inPositionS2
	  eventIn	  SFVec3f	  inPositionA
	  eventIn	  SFVec3f	  inPositionN
	  eventIn	  SFVec3f	  inPositionE3
	  field	  SFFloat	  pPosition	0
	  field	  SFFloat	  oPosition	0.5
	  field	  SFFloat	  s1Position	1
	  field	  SFFloat	  e1Position	1.5
	  field	  SFFloat	  e2Position	2.5
	  field	  SFFloat	  mPosition	3
	  field	  SFFloat	  s2Position	4
	  field	  SFFloat	  aPosition	4.5
	  field	  SFFloat	  nPosition	5
	  field	  SFFloat	  e3Position	5.5
	  field	  SFBool	  isDoneAlready	FALSE
	  field	  SFFloat	  nextLetterPos	0
	  url	"vrmlscript:




// Returns TRUE is pos2 is positioned directly following pos1
// The tolerance is for their spacing to be:   .4 < spacing < 2
function isPos2DirectlyAfterPos1( pos1, pos2)
{
	diff = pos2 - pos1;
        if (diff > 0.15 && diff < 2) {
		return TRUE;
	}
	else {
		return FALSE;
	}
}

// Checks to see if any of choice0, choice1 or choice2 is
// is positioned directly after pos1
//
// If so, sets nextLetterPos to be that value.
//
// returns -1 if none of the choices fits the bill.
// returns 0,1,2 if one of them does
function whichPosIsDirectlyAfterPos1( pos1, choice0, choice1, choice2 )
{
	answer = -1;
	
	// Is the first choice within range?
	if ( isPos2DirectlyAfterPos1( pos1, choice0 )) {
		nextLetterPos = choice0;
		answer = 0;
	}

	// Is the second choice within range but also left of our current 
	// best choice?
	if (isPos2DirectlyAfterPos1( pos1, choice1)) {
		if ( (answer == -1) || (choice1 < nextLetterPos) ) {
			nextLetterPos = choice1;
			answer = 1;
		}
	}
	
	// Is the third choice within range but also left of our current 
	// best choice?
	if (isPos2DirectlyAfterPos1( pos1, choice2)) {
		if ( (answer == -1) || (choice2 < nextLetterPos) ) {
			nextLetterPos = choice2;
			answer = 2;
		}
	}

	// return our best answer
	return answer;
}

function calcIsDone(givenTime)
{
	if (isDoneAlready == TRUE)
		return;
	
	// we want to spell 'open sesame'
	// go letter by letter and see if the tolerances/order are okay.

	// P follows O
	curPos = oPosition;
	nextLetterPos = pPosition;

	if ( ! isPos2DirectlyAfterPos1( curPos, nextLetterPos ))
		return;

	// E follows P, and there are 3 choices.  If successful, the routine
	//              will set the nextLetterPos
	curPos = nextLetterPos;
	wasOk = whichPosIsDirectlyAfterPos1(curPos, e1Position,
						e2Position, e3Position);
	if ( wasOk == -1 ) 
		return;
	
	// N follows E
	curPos = nextLetterPos;
	nextLetterPos = nPosition;
	if ( ! isPos2DirectlyAfterPos1( curPos, nextLetterPos ))
		return;

	// S follows N, and there are 2 choices.
	curPos = nextLetterPos;
	wasOk = whichPosIsDirectlyAfterPos1(curPos, s1Position,
						s2Position, s2Position);
	if ( wasOk == -1 ) 
		return;

	// E follows S, and there are 3 choices.  If successful, the routine
	//              will set the nextLetterPos
	curPos = nextLetterPos;
	wasOk = whichPosIsDirectlyAfterPos1(curPos, e1Position,
						e2Position, e3Position);
	if ( wasOk == -1 ) 
		return;
	
	// S follows E, and there are 2 choices.
	curPos = nextLetterPos;
	wasOk = whichPosIsDirectlyAfterPos1(curPos, s1Position,
						s2Position, s2Position);
	if ( wasOk == -1 ) 
		return;

	// A follows S
	curPos = nextLetterPos;
	nextLetterPos = aPosition;
	if ( ! isPos2DirectlyAfterPos1( curPos, nextLetterPos ))
		return;

	// M follows A
	curPos = nextLetterPos;
	nextLetterPos = mPosition;
	if ( ! isPos2DirectlyAfterPos1( curPos, nextLetterPos ))
		return;

	// E follows M, and there are 3 choices.  If successful, the routine
	//              will set the nextLetterPos
	curPos = nextLetterPos;
	wasOk = whichPosIsDirectlyAfterPos1(curPos, e1Position,
						e2Position, e3Position);
	if ( wasOk == -1 ) 
		return;
	
	// Setting this variable stops us from triggering twice:
	isDoneAlready = TRUE;

	trigger = givenTime;
}

function inPositionP(value, time)
{
	pPosition = value[0];
	calcIsDone(time);
}

function inPositionO(value, time)
{
	oPosition = value[0];
	calcIsDone(time);
}
function inPositionS1(value, time)
{
	s1Position = value[0];
	calcIsDone(time);
}
function inPositionE1(value, time)
{
	e1Position = value[0];
	calcIsDone(time);
}
function inPositionE2(value, time)
{
	e2Position = value[0];
	calcIsDone(time);
}
function inPositionM(value, time)
{
	mPosition = value[0];
	calcIsDone(time);
}
function inPositionS2(value, time)
{
	s2Position = value[0];
	calcIsDone(time);
}
function inPositionA(value, time)
{
	aPosition = value[0];
	calcIsDone(time);
}
function inPositionN(value, time)
{
	nPosition = value[0];
	calcIsDone(time);
}
function inPositionE3(value, time)
{
	e3Position = value[0];
	calcIsDone(time);
}

"
	}
	DEF P Transform {
	  children	[
	    DEF _5 PlaneSensor {
	    }
	    DEF _6 Transform {
	      children	Shape {
		appearance	Appearance {
		  material	DEF _7 Material {
		    ambientIntensity	0
		    diffuseColor	0 0 0
		    specularColor	0.622449 0.622449 0.622449
		    emissiveColor	0 1 0.734243
		    shininess	0.0510204
		    transparency	0
		  }

		  texture	NULL

		  textureTransform	NULL

		}

		geometry	Text {
		  string	"P"
		  fontStyle	FontStyle {
		    size	24
		  }

		  length	0
		}

	      }

	      translation	0 0 0
	      scale	0.02 0.02 0.02
	    }
	  ]
	  translation	0 0 0
	}
	DEF O Transform {
	  children	[
	    DEF _8 PlaneSensor {
	      offset	0.5 0 0
	      autoOffset	TRUE
	    }
	    DEF _9 Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _7

		  texture	NULL

		  textureTransform	NULL

		}

		geometry	Text {
		  string	[ "O",
			    " ",
			    " " ]
		  fontStyle	FontStyle {
		    size	24
		  }

		  length	0
		}

	      }

	      translation	0.5 0 0
	      scale	0.02 0.02 0.02
	    }
	  ]
	  translation	0 0 0
	}
	DEF S Transform {
	  children	[
	    DEF _10 PlaneSensor {
	      offset	1 0 0
	    }
	    DEF _11 Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _7

		  texture	NULL

		  textureTransform	NULL

		}

		geometry	Text {
		  string	[ "S",
			    " ",
			    " " ]
		  fontStyle	FontStyle {
		    size	24
		  }

		  length	0
		}

	      }

	      translation	1 0 0
	      scale	0.02 0.02 0.02
	    }
	  ]
	  translation	0 0 0
	}
	DEF E1 Transform {
	  children	[
	    DEF _12 PlaneSensor {
	      offset	1.5 0 0
	    }
	    DEF _13 Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _7

		  texture	NULL

		  textureTransform	NULL

		}

		geometry	Text {
		  string	[ "E",
			    " " ]
		  fontStyle	FontStyle {
		    size	24
		  }

		  length	0
		}

	      }

	      translation	1.5 0 0
	      scale	0.02 0.02 0.02
	    }
	  ]
	  translation	0 0 0
	}
	DEF E2 Transform {
	  children	[
	    DEF _14 PlaneSensor {
	      offset	2.5 0 0
	    }
	    DEF _15 Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _7

		  texture	NULL

		  textureTransform	NULL

		}

		geometry	Text {
		  string	[ "E",
			    " " ]
		  fontStyle	FontStyle {
		    size	24
		  }

		  length	0
		}

	      }

	      translation	2.5 0 0
	      scale	0.02 0.02 0.02
	    }
	  ]
	  translation	0 0 0
	}
	DEF M Transform {
	  children	[
	    DEF _16 PlaneSensor {
	      offset	3 0 0
	    }
	    DEF _17 Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _7

		  texture	NULL

		  textureTransform	NULL

		}

		geometry	Text {
		  string	[ "M",
			    " ",
			    " " ]
		  fontStyle	FontStyle {
		    size	24
		  }

		  length	0
		}

	      }

	      translation	3 0 0
	      scale	0.02 0.02 0.02
	    }
	  ]
	  translation	0 0 0
	}
	DEF S Transform {
	  children	[
	    DEF _18 PlaneSensor {
	      offset	4 0 0
	    }
	    DEF _19 Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _7

		  texture	NULL

		  textureTransform	NULL

		}

		geometry	Text {
		  string	[ "S",
			    " ",
			    " ",
			    " " ]
		  fontStyle	FontStyle {
		    size	24
		  }

		  length	0
		}

	      }

	      translation	4 0 0
	      scale	0.02 0.02 0.02
	    }
	  ]
	  translation	0 0 0
	}
	DEF A Transform {
	  children	[
	    DEF _20 PlaneSensor {
	      offset	4.5 0 0
	    }
	    DEF _21 Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _7

		  texture	NULL

		  textureTransform	NULL

		}

		geometry	Text {
		  string	[ "A",
			    " ",
			    " " ]
		  fontStyle	FontStyle {
		    size	24
		  }

		  length	0
		}

	      }

	      translation	4.5 0 0
	      scale	0.02 0.02 0.02
	    }
	  ]
	  translation	0 0 0
	}
	DEF N Transform {
	  children	[
	    DEF _22 PlaneSensor {
	      offset	5 0 0
	    }
	    DEF _23 Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _7

		  texture	NULL

		  textureTransform	NULL

		}

		geometry	Text {
		  string	[ "N",
			    " ",
			    " " ]
		  fontStyle	FontStyle {
		    size	24
		  }

		  length	0
		}

	      }

	      translation	5 0 0
	      scale	0.02 0.02 0.02
	    }
	  ]
	  translation	0 0 0
	}
	DEF E3 Transform {
	  children	[
	    DEF _24 PlaneSensor {
	      offset	5.5 0 0
	    }
	    DEF _25 Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _7

		  texture	NULL

		  textureTransform	NULL

		}

		geometry	Text {
		  string	[ "E",
			    " " ]
		  fontStyle	FontStyle {
		    size	24
		  }

		  length	0
		}

	      }

	      translation	5.5 0 0
	      scale	0.02 0.02 0.02
	    }
	  ]
	  translation	0 0 0
	}
      ]
      translation	-2.16253 1.35645 -3.0012
      rotation	0 0 1  0
      scale	0.706832 0.706831 0.706822
    }
    DEF Start Viewpoint {
      position	-2.54402 0.430637 1.25238
      orientation	0.101811 -0.994347 0.0301461  0.437354
      fieldOfView	0.785398
      description	"Start"
    }
    DEF StartNavigationInfo NavigationInfo {
    }
    DEF puzzle2 Transform {
      children	[
	Group {
	  children	[
	    DEF openDoor2 Group {
	      children	DEF Time_28 TimeSensor {
		cycleInterval	1.5
		startTime	0
	      }

	    }
	    DEF puzzle2TranslationInterp PositionInterpolator {
	      key	[ 0, 0.4 ]
	      keyValue	[ -0.235072 0.0454598 3.06136,
		        -0.235072 0.0454598 3.06136 ]
	    }
	    DEF puzzle2CenterInterp PositionInterpolator {
	      key	[ 0, 0.4 ]
	      keyValue	[ 0.71779 0.0315196 -10.3381,
		        0.71779 0.0315196 -10.3381 ]
	    }
	    DEF puzzle2RotationInterp OrientationInterpolator {
	      key	[ 0, 0.4, 0.8 ]
	      keyValue	[ 0 0 1  0,
		        0 0 1  0,
		        0 -1 0  1.5708 ]
	    }
	  ]
	}
	DEF DefaultTouchSensor TouchSensor {
	}
	DEF Puzzle2_Script Script {
	  eventOut	  SFBool	  dragger1Enabled
	  eventOut	  SFBool	  dragger2Enabled
	  eventOut	  SFBool	  dragger3Enabled
	  eventOut	  SFBool	  dragger4Enabled
	  eventOut	  SFBool	  dragger5Enabled
	  eventOut	  SFVec3f	  outPosition1
	  eventOut	  SFVec3f	  outPosition2
	  eventOut	  SFVec3f	  outPosition3
	  eventOut	  SFVec3f	  outPosition4
	  eventOut	  SFVec3f	  outPosition5
	  eventOut	  SFTime	  sound1Trigger
	  eventOut	  SFTime	  puzzleSolvedTrigger
	  eventIn	  SFVec3f	  inPosition1
	  eventIn	  SFVec3f	  inPosition2
	  eventIn	  SFVec3f	  inPosition3
	  eventIn	  SFVec3f	  inPosition4
	  eventIn	  SFVec3f	  inPosition5
	  eventIn	  SFBool	  isActive1
	  eventIn	  SFBool	  isActive2
	  eventIn	  SFBool	  isActive3
	  eventIn	  SFBool	  isActive4
	  eventIn	  SFBool	  isActive5
	  field	  SFBool	  isPiece1Done	FALSE
	  field	  SFBool	  isPiece2Done	FALSE
	  field	  SFBool	  isPiece3Done	FALSE
	  field	  SFBool	  isPiece4Done	FALSE
	  field	  SFBool	  isPiece5Done	FALSE
	  field	  SFVec3f	  pos1	10 10 10
	  field	  SFVec3f	  pos2	10 10 10
	  field	  SFVec3f	  pos3	10 10 10
	  field	  SFVec3f	  pos4	10 10 10
	  field	  SFVec3f	  pos5	10 10 10
	  url	"vrmlscript:


// Each piece is positioned correctly when x & y are both 0.
// We're considered close enough if we're within .2 in each direction.
// Returns TRUE if we're close enough, FALSE otherwise.
function isInCorrectPosition( pos )
{
	if ( pos[0] < .05 && pos[0] > -.05 && 
             pos[1] < .05 && pos[1] > -.05 ) {
		return TRUE;
	}
	else {
		return FALSE;
	}
}


function calcIsDone(givenTime)
{
	// Do nothing if we're already finished
	if ( isPiece1Done && isPiece2Done &&
		isPiece3Done && isPiece4Done &&
		isPiece5Done ) {
		return;
	}

	// we want to position each piece at its own x=0, y=0
	// If the piece was already in the right spot, we'll skip the
	// stuff for that piece
	if ( ! isPiece1Done ) {
		if ( isInCorrectPosition( pos1 ) ) {
			isPiece1Done = TRUE;
			outPosition1 = new SFVec3f(0,0,pos1[2]);
			dragger1Enabled = FALSE;
			sound1Trigger = givenTime;
		}	
	}
	if ( ! isPiece2Done ) {
		if ( isInCorrectPosition( pos2 ) ) {
			isPiece2Done = TRUE;
			outPosition2 = new SFVec3f(0,0,pos2[2]);
			dragger2Enabled = FALSE;
			sound1Trigger = givenTime;
			
		}	
	}
	if ( ! isPiece3Done ) {
		if ( isInCorrectPosition( pos3 ) ) {
			isPiece3Done = TRUE;
			outPosition3 = new SFVec3f(0,0,pos3[2]);
			dragger3Enabled = FALSE;
			sound1Trigger = givenTime;	
		}	
	}
	if ( ! isPiece4Done ) {
		if ( isInCorrectPosition( pos4 ) ) {
			isPiece4Done = TRUE;
			outPosition4 = new SFVec3f(0,0,pos4[2]);
			dragger4Enabled = FALSE;
			sound1Trigger = givenTime;
		}	
	}
	if ( ! isPiece5Done ) {
		if ( isInCorrectPosition( pos5 ) ) {
			isPiece5Done = TRUE;
			outPosition5 = new SFVec3f(0,0,pos5[2]);
			dragger5Enabled = FALSE;
			sound1Trigger = givenTime;	
		}	
	}

	// If we're done, flip the trigger!
	if ( isPiece1Done && isPiece2Done &&
		isPiece3Done && isPiece4Done &&
		isPiece5Done ) {
		puzzleSolvedTrigger = givenTime;
	}
}

function inPosition1(value, time)
{
	pos1 = value;
}
function inPosition2(value, time)
{
	pos2 = value;
}
function inPosition3(value, time)
{
	pos3 = value;
}
function inPosition4(value, time)
{
	pos4 = value;
}
function inPosition5(value, time)
{
	pos5 = value;
}

function isActive1(value, time)
{	
	calcIsDone(time);
}

function isActive2(value, time)
{	
	calcIsDone(time);
}

function isActive3(value, time)
{	
	calcIsDone(time);
}

function isActive4(value, time)
{	
	calcIsDone(time);
}

function isActive5(value, time)
{	
	calcIsDone(time);
}
"
	}
	DEF part1 Transform {
	  children	[
	    DEF _34 PlaneSensor {
	      enabled	TRUE
	      offset	3.65 -0.4 0
	    }
	    DEF part1Geom Transform {
	      children	Shape {
		appearance	Appearance {
		  material	DEF _36 Material {
		  }

		  texture	DEF _37 ImageTexture {
		    url	"delaunay.gif"
		  }

		  textureTransform	DEF _38 TextureTransform {
		    translation	0.06 0.34
		    rotation	0
		    scale	0.722948 0.824259
		    center	0.44 0.16
		  }

		}

		geometry	IndexedFaceSet {
		  coord	Coordinate {
		    point	[ -1.38615 0.809214 -7.30718,
			      -1.73085 0.489306 -7.30718,
			      -1.87391 -0.303039 -7.30718,
			      -1.42106 -0.529165 -7.30718 ]
		  }

		  color	NULL

		  coordIndex	[ 0, 1, 2, 3, -1 ]
		  normal	NULL

		  texCoord	TextureCoordinate {
		    point	[ 0.204476 0.663645,
			      0.0599701 0.529535,
			      0 0.197372,
			      0.189841 0.102577 ]
		  }

		  ccw	TRUE
		  solid	FALSE
		  convex	TRUE
		  creaseAngle	0
		}

	      }

	      translation	3.65 -0.4 0
	      rotation	0 0 1  0
	      scale	1.41476 1.41477 1.41478
	    }
	  ]
	  translation	0 0 0
	  center	1.34943 -0.212789 -10.3381
	}
	DEF part2 Transform {
	  children	[
	    DEF _39 PlaneSensor {
	      enabled	TRUE
	      offset	-1.4 0.414 0.03
	      autoOffset	TRUE
	    }
	    DEF part2Geom Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _36

		  texture	USE _37

		  textureTransform	USE _38

		}

		geometry	IndexedFaceSet {
		  coord	Coordinate {
		    point	[ -0.851829 0.499767 -7.30718,
			      -1.38615 0.809214 -7.30718,
			      -1.42106 -0.529165 -7.30718,
			      -0.953765 -0.773854 -7.30718 ]
		  }

		  color	NULL

		  coordIndex	[ 0, 1, 2, 3, -1 ]
		  normal	NULL

		  texCoord	TextureCoordinate {
		    point	[ 0.42847 0.53392,
			      0.204476 0.663645,
			      0.189841 0.102577,
			      0.385737 0 ]
		  }

		  ccw	TRUE
		  solid	FALSE
		  convex	TRUE
		  creaseAngle	0
		}

	      }

	      translation	-1.4 0.414 0.03
	      rotation	0 0 1  0
	      scale	1.41476 1.41477 1.41478
	    }
	  ]
	  translation	0 0 0
	}
	DEF part3 Transform {
	  children	[
	    DEF _41 PlaneSensor {
	      enabled	TRUE
	      offset	2.13 1.15 0.1
	    }
	    DEF part3Geom Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _36

		  texture	USE _37

		  textureTransform	USE _38

		}

		geometry	IndexedFaceSet {
		  coord	Coordinate {
		    point	[ -0.408806 -0.403917 -7.30718,
			      -0.421922 0.818412 -7.30718,
			      -0.851829 0.499767 -7.30718,
			      -0.953765 -0.773854 -7.30718 ]
		  }

		  color	NULL

		  coordIndex	[ 0, 1, 2, 3, -1 ]
		  normal	NULL

		  texCoord	TextureCoordinate {
		    point	[ 0.614191 0.155083,
			      0.608693 0.667501,
			      0.42847 0.53392,
			      0.385737 0 ]
		  }

		  ccw	TRUE
		  solid	FALSE
		  convex	TRUE
		  creaseAngle	0
		}

	      }

	      translation	2.13 1.15 0.1
	      rotation	0 0 1  0
	      scale	1.41476 1.41477 1.41478
	    }
	  ]
	  translation	0 0 0
	}
	DEF part4 Transform {
	  children	[
	    DEF _43 PlaneSensor {
	      enabled	TRUE
	      offset	1.24 0.39 -0.03
	    }
	    DEF part4Geom Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _36

		  texture	USE _37

		  textureTransform	USE _38

		}

		geometry	IndexedFaceSet {
		  coord	Coordinate {
		    point	[ -0.408806 -0.403917 -7.30718,
			      -0.117838 -0.693333 -7.30718,
			      0.385789 0.578466 -7.30718,
			      -0.421922 0.818412 -7.30718 ]
		  }

		  color	NULL

		  coordIndex	[ 0, 1, 2, 3, -1 ]
		  normal	NULL

		  texCoord	TextureCoordinate {
		    point	[ 0.614191 0.155083,
			      0.736169 0.0337557,
			      0.947297 0.566912,
			      0.608693 0.667501 ]
		  }

		  ccw	TRUE
		  solid	FALSE
		  convex	TRUE
		  creaseAngle	0
		}

	      }

	      translation	1.24 0.39 -0.03
	      rotation	0 0 1  0
	      scale	1.41476 1.41477 1.41478
	    }
	  ]
	  translation	0 0 0
	}
	DEF part5 Transform {
	  children	[
	    DEF _45 PlaneSensor {
	      enabled	TRUE
	      offset	-3.33 -0.28 0.02
	    }
	    DEF part5Geom Transform {
	      children	Shape {
		appearance	Appearance {
		  material	USE _36

		  texture	USE _37

		  textureTransform	USE _38

		}

		geometry	IndexedFaceSet {
		  coord	Coordinate {
		    point	[ 0.385789 0.578466 -7.30718,
			      0.511508 -0.0308816 -7.30718,
			      0.431576 -0.579543 -7.30718,
			      -0.117838 -0.693333 -7.30718 ]
		  }

		  color	NULL

		  coordIndex	[ 3, 2, 1, 0, -1 ]
		  normal	NULL

		  texCoord	TextureCoordinate {
		    point	[ 0.947297 0.566912,
			      1 0.311465,
			      0.966491 0.0814579,
			      0.736169 0.0337557 ]
		  }

		  solid	FALSE
		}

	      }

	      translation	-3.33 -0.28 0.02
	      rotation	0 0 1  0
	      scale	1.41476 1.41477 1.41478
	    }
	  ]
	  translation	0 0 0
	}
	DEF Kerchick Sound {
	  source	DEF Sound1clip_47 AudioClip {
	    url	"buzz.wav"
	    startTime	0
	  }

	  location	-0.855457 0.523479 -10.3031
	}
	DEF puzzle2_victory Sound {
	  source	DEF Sound1clip AudioClip {
	    url	"ss6.wav"
	  }

	  location	-0.855457 0.523479 -10.3031
	}
      ]
      translation	-0.235072 0.0454598 3.06136
      rotation	0 0 1  0
      scale	0.706831 0.706833 0.706821
      scaleOrientation	-5.056e-30 1 -9.3145e-31  0.000690534
      center	0.71779 0.0315196 -10.3381
    }
    DEF _48 Transform {
      children	[
	Group {
	  children	[
	    USE openDoor2
	    DEF UnnamedShapeCenterInterp PositionInterpolator {
	      key	0
	      keyValue	-1.67762 -0.064982 -2.82608
	    }
	    DEF UnnamedShapeRotationInterp OrientationInterpolator {
	      key	[ 0, 0.0666667, 0.133333, 0.2,
		        0.266667, 0.333333, 0.4, 0.466667,
		        0.533334, 0.6, 0.666667 ]
	      keyValue	[ 0 0 1  0,
		        0 1 0  0.100533,
		        0 1 0  0.238762,
		        0 1 0  0.405266,
		        0 1 0  0.590621,
		        0 1 0  0.7854,
		        0 1 0  0.980179,
		        0 1 0  1.16553,
		        0 1 0  1.33204,
		        0 1 0  1.47027,
		        0 1 0  1.5708 ]
	    }
	  ]
	}
	USE DefaultTouchSensor
	Shape {
	  appearance	Appearance {
	    material	Material {
	      ambientIntensity	0.25
	      diffuseColor	0.315389 0.544 0.258052
	      specularColor	0.456 0.456 0.456
	      emissiveColor	0 0 0
	      shininess	0.509389
	      transparency	0
	    }

	    texture	ImageTexture {
	      url	"sky.gif"
	    }

	    textureTransform	NULL

	  }

	  geometry	IndexedFaceSet {
	    coord	Coordinate {
	      point	[ -1.67762 -0.898394 -2.82608,
		        -1.67762 0.76843 -2.82608,
		        0.82272 0.76842 -2.82608,
		        0.822614 -0.898325 -2.82608 ]
	    }

	    color	NULL

	    coordIndex	[ 0, 1, 2, 3, -1 ]
	    colorIndex	[  ]
	    normal	NULL

	    texCoord	TextureCoordinate {
	      point	[ 0.847225 0.0508029,
		        0.847226 0.884215,
		        0.186117 0.88421,
		        0.186144 0.0508373 ]
	    }

	    ccw	TRUE
	    solid	FALSE
	    convex	TRUE
	    creaseAngle	0.5
	  }

	}
      ]
      translation	-0.276275 0.149935 -4.49998
      rotation	0 0 1  0
      scale	0.999996 0.999998 0.999996
      center	-1.67762 -0.064982 -2.82608
    }
  ]
}
ROUTE Puzzle1_Script.trigger TO Time_1.set_startTime
ROUTE Time_1.fraction_changed TO UnnamedShapePointInterp.set_fraction
ROUTE UnnamedShapePointInterp.value_changed TO _3.set_point
ROUTE _6.translation_changed TO Puzzle1_Script.inPositionP
ROUTE _9.translation_changed TO Puzzle1_Script.inPositionO
ROUTE _11.translation_changed TO Puzzle1_Script.inPositionS1
ROUTE _13.translation_changed TO Puzzle1_Script.inPositionE1
ROUTE _15.translation_changed TO Puzzle1_Script.inPositionE2
ROUTE _17.translation_changed TO Puzzle1_Script.inPositionM
ROUTE _19.translation_changed TO Puzzle1_Script.inPositionS2
ROUTE _21.translation_changed TO Puzzle1_Script.inPositionA
ROUTE _23.translation_changed TO Puzzle1_Script.inPositionN
ROUTE _25.translation_changed TO Puzzle1_Script.inPositionE3
ROUTE _5.translation_changed TO _6.set_translation
ROUTE _8.translation_changed TO _9.set_translation
ROUTE _10.translation_changed TO _11.set_translation
ROUTE _12.translation_changed TO _13.set_translation
ROUTE _14.translation_changed TO _15.set_translation
ROUTE _16.translation_changed TO _17.set_translation
ROUTE _18.translation_changed TO _19.set_translation
ROUTE _20.translation_changed TO _21.set_translation
ROUTE _22.translation_changed TO _23.set_translation
ROUTE _24.translation_changed TO _25.set_translation
ROUTE Puzzle2_Script.puzzleSolvedTrigger TO Time_28.set_startTime
ROUTE Time_28.fraction_changed TO puzzle2TranslationInterp.set_fraction
ROUTE Time_28.fraction_changed TO puzzle2CenterInterp.set_fraction
ROUTE Time_28.fraction_changed TO puzzle2RotationInterp.set_fraction
ROUTE part1Geom.translation_changed TO Puzzle2_Script.inPosition1
ROUTE part2Geom.translation_changed TO Puzzle2_Script.inPosition2
ROUTE part3Geom.translation_changed TO Puzzle2_Script.inPosition3
ROUTE part4Geom.translation_changed TO Puzzle2_Script.inPosition4
ROUTE part5Geom.translation_changed TO Puzzle2_Script.inPosition5
ROUTE _34.isActive TO Puzzle2_Script.isActive1
ROUTE _39.isActive TO Puzzle2_Script.isActive2
ROUTE _41.isActive TO Puzzle2_Script.isActive3
ROUTE _43.isActive TO Puzzle2_Script.isActive4
ROUTE _45.isActive TO Puzzle2_Script.isActive5
ROUTE Puzzle2_Script.dragger1Enabled TO _34.set_enabled
ROUTE _34.translation_changed TO part1Geom.set_translation
ROUTE Puzzle2_Script.outPosition1 TO part1Geom.set_translation
ROUTE Puzzle2_Script.dragger2Enabled TO _39.set_enabled
ROUTE _39.translation_changed TO part2Geom.set_translation
ROUTE Puzzle2_Script.outPosition2 TO part2Geom.set_translation
ROUTE Puzzle2_Script.dragger3Enabled TO _41.set_enabled
ROUTE _41.translation_changed TO part3Geom.set_translation
ROUTE Puzzle2_Script.outPosition3 TO part3Geom.set_translation
ROUTE Puzzle2_Script.dragger4Enabled TO _43.set_enabled
ROUTE _43.translation_changed TO part4Geom.set_translation
ROUTE Puzzle2_Script.outPosition4 TO part4Geom.set_translation
ROUTE Puzzle2_Script.dragger5Enabled TO _45.set_enabled
ROUTE _45.translation_changed TO part5Geom.set_translation
ROUTE Puzzle2_Script.outPosition5 TO part5Geom.set_translation
ROUTE Puzzle2_Script.sound1Trigger TO Sound1clip_47.set_startTime
ROUTE puzzle2TranslationInterp.value_changed TO puzzle2.set_translation
ROUTE puzzle2RotationInterp.value_changed TO puzzle2.set_rotation
ROUTE puzzle2CenterInterp.value_changed TO puzzle2.set_center
ROUTE Time_28.fraction_changed TO UnnamedShapeCenterInterp.set_fraction
ROUTE Time_28.fraction_changed TO UnnamedShapeRotationInterp.set_fraction
ROUTE UnnamedShapeRotationInterp.value_changed TO _48.set_rotation
ROUTE UnnamedShapeCenterInterp.value_changed TO _48.set_center
