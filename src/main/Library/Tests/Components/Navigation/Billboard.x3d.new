<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 3.3//EN" "https://www.web3d.org/specifications/x3d-3.3.dtd">
<X3D xmlns:xsd="http://www.w3.org/2001/XMLSchema-instance" profile="Full" version="3.3" xsd:noNamespaceSchemaLocation="http://www.web3d.org/specifications/x3d-3.3.xsd" ><head><meta name="comment" content="World of Titania"></meta>
<meta name="created" content="Fri, 18 Sep 2015 01:10:27 GMT"></meta>
<meta name="creator" content="Holger Seelig"></meta>
<meta name="generator" content="Titania V1.2.2, http://titania.create3000.de"></meta>
<meta name="modified" content="Sat, 02 Jan 2016 06:07:53 GMT"></meta>
<meta name="title" content="Billboard 1 1 1"></meta>
</head>
<Scene><WorldInfo title="Billboard"><MetadataSet containerField="metadata" name="Titania" DEF="Titania" reference="http://titania.create3000.de"><MetadataSet name="NavigationInfo" DEF="NavigationInfo" reference="http://titania.create3000.de" containerField="value"><MetadataString name="type" DEF="type" reference="http://titania.create3000.de" value="&quot;EXAMINE&quot;" containerField="value"></MetadataString>
</MetadataSet>
<MetadataSet name="Viewpoint" DEF="Viewpoint" reference="http://titania.create3000.de"><MetadataDouble name="position" DEF="position" reference="http://titania.create3000.de" value="0 0 10" containerField="value"></MetadataDouble>
<MetadataDouble name="orientation" DEF="orientation" reference="http://titania.create3000.de" value="0 0 1 0"></MetadataDouble>
<MetadataDouble name="centerOfRotation" DEF="centerOfRotation" reference="http://titania.create3000.de" value="0 0 0"></MetadataDouble>
</MetadataSet>
</MetadataSet>
</WorldInfo>
<Background skyAngle="0.8 1.3 1.4 1.5708" skyColor="0.21 0.31 0.59 0.33 0.45 0.7 0.57 0.66 0.85 0.6 0.73 0.89 0.7 0.83 0.98" groundAngle="0.6 1.2 1.3 1.5708" groundColor="0.21 0.31 0.59 0.33 0.45 0.7 0.57 0.66 0.85 0.6 0.73 0.89 0.7 0.83 0.98"></Background>
<Viewpoint description="Front"></Viewpoint>
<Viewpoint description="z pi/2" orientation="0 0 1 1.5708"></Viewpoint>
<Viewpoint description="y pi/2" position="10 0 0" orientation="0 1 0 1.5708"></Viewpoint>
<ProximitySensor DEF="Proxy" size="1000 1000 1000"></ProximitySensor>
<Transform DEF="HUD" translation="0 0 10"><Transform translation="0 -0.3 -1" scale="0.02 0.02 0.02"><Transform><TouchSensor DEF="TouchX" description="1 0 0"></TouchSensor>
<Transform><Shape><Appearance><Material DEF="Rococo12" ambientIntensity="0.226102" diffuseColor="0.904409 0.146366 0.208768" specularColor="0.0955906 0.0955906 0.0955906" shininess="0.078125"></Material>
</Appearance>
<Box containerField="geometry"></Box>
</Shape>
</Transform>
</Transform>
<Transform translation="3 0 0"><TouchSensor DEF="TouchY" description="0 1 0"></TouchSensor>
<Transform><Shape><Appearance><Material DEF="Rococo28" ambientIntensity="0.226102" diffuseColor="0.279645 0.904409 0.511589" specularColor="0.0955906 0.0955906 0.0955906" shininess="0.078125"></Material>
</Appearance>
<Box containerField="geometry"></Box>
</Shape>
</Transform>
</Transform>
<Transform translation="6 0 0"><TouchSensor DEF="TouchXYZ" description="1 1 1"></TouchSensor>
<Transform><Shape><Appearance><Material DEF="Rococo24" ambientIntensity="0.226102" diffuseColor="0.28636 0.554905 0.904409" specularColor="0.0955906 0.0955906 0.0955906" shininess="0.078125"></Material>
</Appearance>
<Box containerField="geometry"></Box>
</Shape>
</Transform>
</Transform>
<Transform translation="9 0 0"><TouchSensor DEF="TouchZ" description="0 0 1"></TouchSensor>
<Transform><Shape><Appearance><Material DEF="Rococo1" ambientIntensity="0.187004" diffuseColor="0.636212 0.748016 0.300948" specularColor="0.412121 0.412121 0.412121" shininess="0.8"></Material>
</Appearance>
<Box containerField="geometry"></Box>
</Shape>
</Transform>
</Transform>
<Transform translation="12 0 -5.68434e-14"><TouchSensor DEF="TouchZ_1" description="0 0 0"></TouchSensor>
<Transform><Shape><Appearance><Material DEF="Rococo35" ambientIntensity="0.0499912" diffuseColor="0.195355 0.197924 0.199965" specularColor="0.430303 0.430303 0.430303" shininess="0.406061"></Material>
</Appearance>
<Box containerField="geometry"></Box>
</Shape>
</Transform>
</Transform>
</Transform>
</Transform>
<Transform><Billboard DEF="Billboard" axisOfRotation="1 1 1"><Transform DEF="XForm"><Transform rotation="1 0 0 1.5708"><Shape><Appearance><Material></Material>
</Appearance>
<Cone containerField="geometry"></Cone>
</Shape>
</Transform>
<Shape><Appearance><Material></Material>
</Appearance>
<IndexedLineSet containerField="geometry" colorIndex="0 1 -1 2 3 -1" coordIndex="0 1 -1 2 3 -1"><Color color="0 0 0 1 1 1 0 0 0 1 1 1"></Color>
<Coordinate containerField="coord" DEF="Local" point="-2 0 0 2 0 0 0 -2 0 0 2 0"></Coordinate>
</IndexedLineSet>
</Shape>
<Transform translation="2 0 0" scale="0.5 0.5 0.5"><Billboard axisOfRotation="0 0 0"><Shape><Appearance><Material diffuseColor="0 0 0"></Material>
</Appearance>
<Text containerField="geometry" string="&quot;x&quot;"></Text>
</Shape>
</Billboard>
</Transform>
<Transform translation="0 2 0" scale="0.5 0.5 0.5"><Billboard axisOfRotation="0 0 0"><Shape><Appearance><Material diffuseColor="0 0 0"></Material>
</Appearance>
<Text containerField="geometry" string="&quot;y&quot;"></Text>
</Shape>
</Billboard>
</Transform>
</Transform>
<Shape DEF="LocalAxisOfRotation1"><Appearance><LineProperties linetype="3"></LineProperties>
<Material></Material>
</Appearance>
<IndexedLineSet containerField="geometry" coordIndex="0 1 -1"><Coordinate containerField="coord" DEF="LocalAxisOfRotation" point="-3 -3 -3 3 3 3"></Coordinate>
</IndexedLineSet>
</Shape>
</Billboard>
</Transform>
<Transform><SphereSensor DEF="AxisSensor" offset="-0.707107 0.707107 0 0.955317"></SphereSensor>
<Transform DEF="AxisOfRotation" rotation="-0.707107 0.707107 0 0.955317"><Transform translation="0 0 2" rotation="1 0 0 1.5708" scale="0.1 0.1 0.1"><Shape><Appearance><Material diffuseColor="0 1 0"></Material>
</Appearance>
<Cone containerField="geometry"></Cone>
</Shape>
</Transform>
<Transform translation="0 0 -2" scale="0.1 0.1 0.1"><Shape><Appearance><Material diffuseColor="1 0 0"></Material>
</Appearance>
<Sphere containerField="geometry"></Sphere>
</Shape>
</Transform>
<Shape><Appearance><Material></Material>
</Appearance>
<IndexedLineSet containerField="geometry" colorPerVertex="false" colorIndex="0 1" coordIndex="0 1 -1 1 2 -1"><Color color="1 0 0 0 1 0"></Color>
<Coordinate containerField="coord" point="0 0 -2 0 0 0 0 0 2"></Coordinate>
</IndexedLineSet>
</Shape>
</Transform>
</Transform>
<Transform DEF="ZAxis"><Shape><Appearance><Material></Material>
</Appearance>
<IndexedLineSet containerField="geometry" colorPerVertex="false" colorIndex="0 1" coordIndex="0 1 -1 1 2 -1"><Color color="0 0 0 0 0 1"></Color>
<Coordinate containerField="coord" point="0 0 -2 0 0 0 0 0 2"></Coordinate>
</IndexedLineSet>
</Shape>
<Transform translation="0 0 2" scale="0.5 0.5 0.5"><Billboard axisOfRotation="0 0 0"><Shape><Appearance><Material diffuseColor="0 0 0"></Material>
</Appearance>
<Text containerField="geometry" string="&quot; z&quot;"></Text>
</Shape>
</Billboard>
</Transform>
<Transform translation="0 0 2" rotation="1 0 0 1.5708" scale="0.1 0.1 0.1"><Shape><Appearance><Material diffuseColor="0 0 1"></Material>
</Appearance>
<Cone containerField="geometry"></Cone>
</Shape>
</Transform>
</Transform>
<Transform DEF="Normal" rotation="0.707107 0.707107 0 1.5708"><Shape><Appearance><Material></Material>
</Appearance>
<IndexedLineSet containerField="geometry" colorPerVertex="false" colorIndex="0 1" coordIndex="0 1 -1"><Color color="1 1 0 1 1 0"></Color>
<Coordinate containerField="coord" point="0 0 0 0 0 2"></Coordinate>
</IndexedLineSet>
</Shape>
<Transform translation="0 0 2" rotation="1 0 0 1.5708" scale="0.1 0.1 0.1"><Shape><Appearance><Material diffuseColor="1 1 0"></Material>
</Appearance>
<Cone containerField="geometry"></Cone>
</Shape>
</Transform>
<Transform translation="0 0 2" scale="0.3 0.3 0.3"><Billboard axisOfRotation="0 0 0"><Shape><Appearance><Material diffuseColor="0 0 0"></Material>
</Appearance>
<Text containerField="geometry" string="&quot; normal&quot;"></Text>
</Shape>
</Billboard>
</Transform>
</Transform>
<Transform DEF="Rotation" rotation="-0.357407 -0.862856 -0.357407 1.71777"><Shape><Appearance><Material emissiveColor="1 0 0"></Material>
</Appearance>
<Arc2D containerField="geometry" DEF="Arc" endAngle="0.955317"></Arc2D>
</Shape>
</Transform>
<Script DEF="AxisScript" directOutput="true"><field name="set_x" accessType="inputOnly" type="SFTime"></field>
<field name="set_y" accessType="inputOnly" type="SFTime"></field>
<field name="set_z" accessType="inputOnly" type="SFTime"></field>
<field name="set_xyz" accessType="inputOnly" type="SFTime"></field>
<field name="set_0" accessType="inputOnly" type="SFTime"></field>
<field name="set_rotation" accessType="inputOnly" type="SFRotation"></field>
<field name="set_position" accessType="inputOnly" type="SFVec3f"></field>
<field name="billboard" accessType="initializeOnly" type="SFNode"><Billboard USE="Billboard"></Billboard>
</field>
<field name="xform" accessType="initializeOnly" type="SFNode"><Transform USE="XForm"></Transform>
</field>
<field name="absolute" accessType="initializeOnly" type="SFNode"><Transform USE="AxisOfRotation"></Transform>
</field>
<field name="local" accessType="initializeOnly" type="SFNode"><Coordinate USE="LocalAxisOfRotation"></Coordinate>
</field>
<field name="sensor" accessType="initializeOnly" type="SFNode"><SphereSensor USE="AxisSensor"></SphereSensor>
</field>
<field name="normal" accessType="initializeOnly" type="SFNode"><Transform USE="Normal"></Transform>
</field>
<field name="rotation" accessType="initializeOnly" type="SFNode"><Transform USE="Rotation"></Transform>
</field>
<field name="arc" accessType="initializeOnly" type="SFNode"><Arc2D USE="Arc"></Arc2D>
</field>
<field name="proxy" accessType="initializeOnly" type="SFNode"><ProximitySensor USE="Proxy"></ProximitySensor>
</field>
<![CDATA[vrmlscript:
function initialize ()
{
	set_xyz ();
}

function set_x ()
{
	set_axisOfRotation (new SFVec3f (1, 0, 0));
}

function set_y ()
{
	set_axisOfRotation (new SFVec3f (0, 1, 0));
}

function set_z ()
{
	set_axisOfRotation (new SFVec3f (0, 0, 1) .normalize () .multiply (2));
}

function set_xyz ()
{
	set_axisOfRotation (new SFVec3f (1, 1, 1));
}

function set_0 ()
{
	set_axisOfRotation (new SFVec3f ());
}

function set_rotation (value)
{
	set_axisOfRotation (value .multVec (new SFVec3f (0, 0, 1)));
}

function set_position ()
{
	set_axisOfRotation (billboard .axisOfRotation);
}

var xAxis = new SFVec3f (1, 0, 0);
var zAxis = new SFVec3f (0, 0, 1);

function set_axisOfRotation (axisOfRotation)
{
	billboard .axisOfRotation = axisOfRotation;
	
	// Normal of plane between axisOfRotation and billbordToViewer

	var vector = axisOfRotation .cross (proxy .position_changed);
	normal .rotation = new SFRotation (zAxis, vector);

	// axisOfRotation

	var axisRotation = new SFRotation (zAxis, axisOfRotation);
	
	local .point       = new MFVec3f (axisOfRotation .multiply (3) .negate (), axisOfRotation .multiply (3));
	absolute .rotation = axisRotation;
	sensor .offset     = axisRotation;

	// Angle between zAxis and axisOfRotation
	var angle = Math .acos (zAxis .dot (axisOfRotation .normalize ()));
	var rot   = new SFRotation (zAxis, zAxis .cross (axisOfRotation));
	rotation .rotation = rot .multiply (new SFRotation (rot .multVec (xAxis), zAxis));

	arc .endAngle = angle;

	print ('axisOfRotation: ', local .point);
	print ('axisOfRotation: ', axisOfRotation);
	print ('normal:         ', vector);
	print ('angle:          ', angle);
	

	var n = vector .normalize ();
	var a = axisOfRotation .cross (zAxis .cross (axisOfRotation)) .normalize ();
			
	var angle = n .dot (a);
	print ('angle n         ', angle);

}]]></Script>
<ROUTE fromNode="Proxy" fromField="position_changed" toNode="HUD" toField="set_translation"></ROUTE>
<ROUTE fromNode="Proxy" fromField="orientation_changed" toNode="HUD" toField="set_rotation"></ROUTE>
<ROUTE fromNode="Proxy" fromField="position_changed" toNode="AxisScript" toField="set_position"></ROUTE>
<ROUTE fromNode="TouchX" fromField="touchTime" toNode="AxisScript" toField="set_x"></ROUTE>
<ROUTE fromNode="TouchY" fromField="touchTime" toNode="AxisScript" toField="set_y"></ROUTE>
<ROUTE fromNode="TouchZ" fromField="touchTime" toNode="AxisScript" toField="set_z"></ROUTE>
<ROUTE fromNode="TouchXYZ" fromField="touchTime" toNode="AxisScript" toField="set_xyz"></ROUTE>
<ROUTE fromNode="AxisSensor" fromField="rotation_changed" toNode="AxisScript" toField="set_rotation"></ROUTE>
<ROUTE fromNode="TouchZ_1" fromField="touchTime" toNode="AxisScript" toField="set_0"></ROUTE>
</Scene>
</X3D>