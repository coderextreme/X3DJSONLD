<!DOCTYPE html>
<html>
<head>
    <title>X3DOM Content</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="https://www.x3dom.org/download/dev/x3dom.css" />
    <script type="text/javascript" src="https://www.x3dom.org/download/dev/x3dom-full.debug.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        X3D { width: 100%; height: 100%; border: none; background: #000; }
    </style>
</head>
<body>
    <X3D id="x3dom_canvas_dynamic" showProgress="false" showStat="false" showLog="false" backend="webgl">
        <Scene>
            <!-- Content will be loaded here by parent -->
        </Scene>
    </X3D>

    <script>
        function loadContentInX3dom(xmlString) {
            var x3dElement = document.getElementById('x3dom_canvas_dynamic');
            var sceneElement = x3dElement.querySelector('Scene');

            if (sceneElement) {
                // Clear previous scene children
                while (sceneElement.firstChild) {
                    sceneElement.removeChild(sceneElement.firstChild);
                }
                
                if (xmlString) {
                    try {
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(xmlString, "application/xml");
                        const newSceneContent = xmlDoc.querySelector('X3D > Scene'); // Get the Scene element itself
                        
                        if (newSceneContent && newSceneContent.childNodes) {
                             Array.from(newSceneContent.childNodes).forEach(child => {
                                sceneElement.appendChild(document.importNode(child, true));
                            });
                        } else {
                            console.warn("Could not find Scene content in provided XML for X3DOM.");
                        }
                        
                        if (x3dElement.runtime && x3dElement.runtime.ready) {
                           // Notify X3DOM to update the scene
                           x3dElement.runtime.recollectNamedNodes();
                           x3dElement.runtime.canvas.doc.needRender = true;
                        } else if (typeof x3dom !== 'undefined' && x3dom.reload) {
                            x3dom.reload(); // Fallback if runtime direct access is tricky
                        }

                    } catch (e) {
                        console.error("Error parsing or loading XML into X3DOM:", e, xmlString);
                        sceneElement.appendChild(document.createTextNode("Error loading content."));
                    }
                }
            } else {
                console.error("X3DOM element or scene not found.");
            }
        }
    </script>
</body>
</html>
