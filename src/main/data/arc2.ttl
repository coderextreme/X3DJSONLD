@prefix : <https://coderextreme.net/X3DJSONLD/src/main/data/arc1.ttl#> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <http://schema.org/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix x3d: <https://www.web3d.org/semantics/ontologies/X3dOntology4.0#> .

:Scene rdf:type owl:NamedIndividual, x3d:Scene .
:Viewpoint_2 rdf:type owl:NamedIndividual, x3d:Viewpoint ;
  x3d:position "0 0 5" ;
  x3d:description "Only Viewpoint" .
:Background_2 rdf:type owl:NamedIndividual, x3d:Background ;
  x3d:skyColor "0.4 0.4 0.4" .
:G1 rdf:type owl:NamedIndividual, x3d:Transform .
:G1 x3d:hasTransform :DECLpoint_INSTANCE_node .
:DECLpoint_INSTANCE_node rdf:type owl:NamedIndividual, x3d:Transform .
:DECLpoint_INSTANCE_node x3d:hasShape :Shape_2_3_1 .
:Shape_2_3_1 rdf:type owl:NamedIndividual, x3d:Shape .
:Sphere_2_3_1_1 rdf:type owl:NamedIndividual, x3d:Sphere ;
  x3d:radius "0.1" .
:Appearance_2_3_1_1 rdf:type owl:NamedIndividual, x3d:Appearance .
:Material_2_3_1_1_2 rdf:type owl:NamedIndividual, x3d:Material ;
  x3d:diffuseColor "1 0 0" .
:DECLpoint_INSTANCE_node x3d:hasPositionInterpolator :DECLpoint_INSTANCE_PI1 .
:DECLpoint_INSTANCE_PI1 rdf:type owl:NamedIndividual, x3d:PositionInterpolator ;
  x3d:key "0 1" ;
  x3d:keyValue "0 0 0 0 5 0" .
:DECLpoint_INSTANCE_node x3d:hasScript :DECLpoint_INSTANCE_MB1 .
:DECLpoint_INSTANCE_MB1 rdf:type owl:NamedIndividual, x3d:Script .

                    :DECLpoint_INSTANCE_MB1 x3d:hasfield :field_2_3_1_3 .
:field_2_3_1_3 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "translation" ;
  x3d:accessType "inputOutput" ;
  x3d:type "SFVec3f" ;
  x3d:value "0 0 0" .

                    :DECLpoint_INSTANCE_MB1 x3d:hasfield :field_2_3_1_3 .
:field_2_3_1_3 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "old" ;
  x3d:accessType "inputOutput" ;
  x3d:type "SFVec3f" ;
  x3d:value "0 0 0" .

                    :DECLpoint_INSTANCE_MB1 x3d:hasfield :field_2_3_1_3 .
:field_2_3_1_3 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "set_location" ;
  x3d:accessType "inputOnly" ;
  x3d:type "SFTime" .

                    :DECLpoint_INSTANCE_MB1 x3d:hasfield :field_2_3_1_3 .
:field_2_3_1_3 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "keyValue" ;
  x3d:accessType "inputOutput" ;
  x3d:type "MFVec3f" ;
  x3d:value "0 0 0 0 5 0" .



ecmascript:
               function set_location(value) {
                    old = translation;
                    translation = new SFVec3f(Math.random()*10-5, Math.random()*10-5, Math.random()*10-5);
                    keyValue = new MFVec3f(old, translation);
               }


:DECLpoint_INSTANCE_node x3d:hasTimeSensor :DECLpoint_INSTANCE_CL1 .
:DECLpoint_INSTANCE_CL1 rdf:type owl:NamedIndividual, x3d:TimeSensor ;
  x3d:cycleInterval "3" ;
  x3d:loop "true" .
:DECLpoint_INSTANCE_node x3d:hasROUTE :ROUTE_2_3_1 .
:ROUTE_2_3_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "DECLpoint_INSTANCE_CL1" ;
  x3d:fromField "cycleTime" ;
  x3d:toNode "DECLpoint_INSTANCE_MB1" ;
  x3d:toField "set_location" .
:DECLpoint_INSTANCE_node x3d:hasROUTE :ROUTE_2_3_1 .
:ROUTE_2_3_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "DECLpoint_INSTANCE_CL1" ;
  x3d:fromField "fraction_changed" ;
  x3d:toNode "DECLpoint_INSTANCE_PI1" ;
  x3d:toField "set_fraction" .
:DECLpoint_INSTANCE_node x3d:hasROUTE :ROUTE_2_3_1 .
:ROUTE_2_3_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "DECLpoint_INSTANCE_MB1" ;
  x3d:fromField "keyValue" ;
  x3d:toNode "DECLpoint_INSTANCE_PI1" ;
  x3d:toField "keyValue" .
:DECLpoint_INSTANCE_node x3d:hasROUTE :ROUTE_2_3_1 .
:ROUTE_2_3_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "DECLpoint_INSTANCE_PI1" ;
  x3d:fromField "value_changed" ;
  x3d:toNode "DECLpoint_INSTANCE_node" ;
  x3d:toField "set_translation" .
:DECLpoint_INSTANCE_node x3d:hasROUTE :ROUTE_2_3_1 .
:ROUTE_2_3_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "DECLpoint_INSTANCE_MB1" ;
  x3d:fromField "translation_changed" ;
  x3d:toNode "DECLpoint_INSTANCE_node" ;
  x3d:toField "set_translation" .
:G2 rdf:type owl:NamedIndividual, x3d:Transform .
:G2 x3d:hasTransform :DECLpoint_INSTANCE1000_node .
:DECLpoint_INSTANCE1000_node rdf:type owl:NamedIndividual, x3d:Transform .
:DECLpoint_INSTANCE1000_node x3d:hasShape :Shape_2_4_1 .
:Shape_2_4_1 rdf:type owl:NamedIndividual, x3d:Shape .
:Sphere_2_4_1_1 rdf:type owl:NamedIndividual, x3d:Sphere ;
  x3d:radius "0.1" .
:Appearance_2_4_1_1 rdf:type owl:NamedIndividual, x3d:Appearance .
:Material_2_4_1_1_2 rdf:type owl:NamedIndividual, x3d:Material ;
  x3d:diffuseColor "1 0 0" .
:DECLpoint_INSTANCE1000_node x3d:hasPositionInterpolator :DECLpoint_INSTANCE1000_PI1 .
:DECLpoint_INSTANCE1000_PI1 rdf:type owl:NamedIndividual, x3d:PositionInterpolator ;
  x3d:key "0 1" ;
  x3d:keyValue "0 0 0 0 5 0" .
:DECLpoint_INSTANCE1000_node x3d:hasScript :DECLpoint_INSTANCE1000_MB1 .
:DECLpoint_INSTANCE1000_MB1 rdf:type owl:NamedIndividual, x3d:Script .

                    :DECLpoint_INSTANCE1000_MB1 x3d:hasfield :field_2_4_1_3 .
:field_2_4_1_3 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "translation" ;
  x3d:accessType "inputOutput" ;
  x3d:type "SFVec3f" ;
  x3d:value "0 0 0" .

                    :DECLpoint_INSTANCE1000_MB1 x3d:hasfield :field_2_4_1_3 .
:field_2_4_1_3 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "old" ;
  x3d:accessType "inputOutput" ;
  x3d:type "SFVec3f" ;
  x3d:value "0 0 0" .

                    :DECLpoint_INSTANCE1000_MB1 x3d:hasfield :field_2_4_1_3 .
:field_2_4_1_3 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "set_location" ;
  x3d:accessType "inputOnly" ;
  x3d:type "SFTime" .

                    :DECLpoint_INSTANCE1000_MB1 x3d:hasfield :field_2_4_1_3 .
:field_2_4_1_3 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "keyValue" ;
  x3d:accessType "inputOutput" ;
  x3d:type "MFVec3f" ;
  x3d:value "0 0 0 0 5 0" .



ecmascript:
               function set_location(value) {
                    old = translation;
                    translation = new SFVec3f(Math.random()*10-5, Math.random()*10-5, Math.random()*10-5);
                    keyValue = new MFVec3f(old, translation);
               }


:DECLpoint_INSTANCE1000_node x3d:hasTimeSensor :DECLpoint_INSTANCE1000_CL1 .
:DECLpoint_INSTANCE1000_CL1 rdf:type owl:NamedIndividual, x3d:TimeSensor ;
  x3d:cycleInterval "3" ;
  x3d:loop "true" .
:DECLpoint_INSTANCE1000_node x3d:hasROUTE :ROUTE_2_4_1 .
:ROUTE_2_4_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "DECLpoint_INSTANCE1000_CL1" ;
  x3d:fromField "cycleTime" ;
  x3d:toNode "DECLpoint_INSTANCE1000_MB1" ;
  x3d:toField "set_location" .
:DECLpoint_INSTANCE1000_node x3d:hasROUTE :ROUTE_2_4_1 .
:ROUTE_2_4_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "DECLpoint_INSTANCE1000_CL1" ;
  x3d:fromField "fraction_changed" ;
  x3d:toNode "DECLpoint_INSTANCE1000_PI1" ;
  x3d:toField "set_fraction" .
:DECLpoint_INSTANCE1000_node x3d:hasROUTE :ROUTE_2_4_1 .
:ROUTE_2_4_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "DECLpoint_INSTANCE1000_MB1" ;
  x3d:fromField "keyValue" ;
  x3d:toNode "DECLpoint_INSTANCE1000_PI1" ;
  x3d:toField "keyValue" .
:DECLpoint_INSTANCE1000_node x3d:hasROUTE :ROUTE_2_4_1 .
:ROUTE_2_4_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "DECLpoint_INSTANCE1000_PI1" ;
  x3d:fromField "value_changed" ;
  x3d:toNode "DECLpoint_INSTANCE1000_node" ;
  x3d:toField "set_translation" .
:DECLpoint_INSTANCE1000_node x3d:hasROUTE :ROUTE_2_4_1 .
:ROUTE_2_4_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "DECLpoint_INSTANCE1000_MB1" ;
  x3d:fromField "translation_changed" ;
  x3d:toNode "DECLpoint_INSTANCE1000_node" ;
  x3d:toField "set_translation" .
:transC1 rdf:type owl:NamedIndividual, x3d:Transform .
:transC1 x3d:hasTransform :rotscaleC1 .
:rotscaleC1 rdf:type owl:NamedIndividual, x3d:Transform .
:rotscaleC1 x3d:hasShape :Shape_2_5_1 .
:Shape_2_5_1 rdf:type owl:NamedIndividual, x3d:Shape .
:Appearance_2_5_1_1 rdf:type owl:NamedIndividual, x3d:Appearance .
:Material_2_5_1_1_1 rdf:type owl:NamedIndividual, x3d:Material ;
  x3d:diffuseColor "0.2 0.7 0.7" ;
  x3d:transparency "0.5" .
:Cylinder_2_5_1_1 rdf:type owl:NamedIndividual, x3d:Cylinder ;
  x3d:radius "0.05" .
:DECLx3dconnector_connector1_S1 rdf:type owl:NamedIndividual, x3d:Script .

            :DECLx3dconnector_connector1_S1 x3d:hasfield :field_2_6 .
:field_2_6 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "startnode" ;
  x3d:accessType "initializeOnly" ;
  x3d:type "SFNode" .
:G1-USE-1 rdf:type owl:NamedIndividual, x3d:Transform .

            :DECLx3dconnector_connector1_S1 x3d:hasfield :field_2_6 .
:field_2_6 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "endnode" ;
  x3d:accessType "initializeOnly" ;
  x3d:type "SFNode" .
:G2-USE-1 rdf:type owl:NamedIndividual, x3d:Transform .

            :DECLx3dconnector_connector1_S1 x3d:hasfield :field_2_6 .
:field_2_6 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "transC1" ;
  x3d:accessType "initializeOnly" ;
  x3d:type "SFNode" .
:transC1-USE-1 rdf:type owl:NamedIndividual, x3d:Transform .

            :DECLx3dconnector_connector1_S1 x3d:hasfield :field_2_6 .
:field_2_6 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "rotscaleC1" ;
  x3d:accessType "initializeOnly" ;
  x3d:type "SFNode" .
:rotscaleC1-USE-1 rdf:type owl:NamedIndividual, x3d:Transform .

            :DECLx3dconnector_connector1_S1 x3d:hasfield :field_2_6 .
:field_2_6 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "set_startpoint" ;
  x3d:accessType "inputOnly" ;
  x3d:type "SFVec3f" .

            :DECLx3dconnector_connector1_S1 x3d:hasfield :field_2_6 .
:field_2_6 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "set_endpoint" ;
  x3d:accessType "inputOnly" ;
  x3d:type "SFVec3f" .


            ecmascript:
        function recompute(startpoint,endpoint){
	    if (typeof endpoint === 'undefined') {
		return;
	    }
            var dif = endpoint.subtract(startpoint);
            var dist = dif.length()*0.5;
            var dif2 = dif.multiply(0.5);
            var norm = dif.normalize();
            var transl = startpoint.add(dif2);
	    if (typeof Quaternion !== 'undefined') {
		    return {
			    scale : new SFVec3f(1.0,dist,1.0),
			    translation : transl,
			    rotation : new Quaternion.rotateFromTo(new SFVec3f(0.0,1.0,0.0), norm)
		    };
	    } else {
		    return {
			    scale : new SFVec3f(1.0,dist,1.0),
			    translation : transl,
			    rotation : new SFRotation(new SFVec3f(0.0,1.0,0.0),norm)
		    };
	    }
	}
	function recompute_and_route(startpoint, endpoint) {
	      var trafo = recompute(startpoint, endpoint);
	      transC1.translation = trafo.translation;
	      rotscaleC1.rotation = trafo.rotation;
	      rotscaleC1.scale = trafo.scale;
	}
        function initialize(){
            recompute_and_route(startnode.translation,endnode.translation);
        }
        function set_startpoint(val,t){
            recompute_and_route(val,endnode.translation);
        }
        function set_endpoint(val,t){
            recompute_and_route(startnode.translation,val);
        }


:ROUTE_2 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "G1" ;
  x3d:fromField "translation_changed" ;
  x3d:toNode "DECLx3dconnector_connector1_S1" ;
  x3d:toField "set_startpoint" .
:ROUTE_2 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "G2" ;
  x3d:fromField "translation_changed" ;
  x3d:toNode "DECLx3dconnector_connector1_S1" ;
  x3d:toField "set_endpoint" .
