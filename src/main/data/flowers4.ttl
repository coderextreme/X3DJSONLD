@prefix : <https://www.web3d.org/semantics/scenes/X3dScene1#> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <http://schema.org/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix x3d: <https://www.web3d.org/semantics/ontologies/X3dOntology4.0#> .

[ rdf:type owl:Ontology ;
   owl:imports <file:/E:/Rackstation-SVN/Papers/2019/IC3D-X3D/Paper/Files/X3dOntology4.0.ttl>
 ] .

:Scene-anonymous rdf:type owl:NamedIndividual , x3d:Scene .
:NavigationInfo-anonymous rdf:type owl:NamedIndividual , x3d:NavigationInfo ;
	x3d:avatarSize "0.25 1.6 0.75" ;
	x3d:headlight "true" ;
	x3d:speed "1" ;
	x3d:transitionType "LINEAR" ;
	x3d:transitionTime "1.0" ;
	x3d:visibilityLimit "0" ;
	x3d:containerField "children" .
:Background-anonymous rdf:type owl:NamedIndividual , x3d:Background ;
	x3d:backUrl "../resources/images/all_probes/stpeters_cross/stpeters_back.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_back.png" ;
	x3d:bottomUrl "../resources/images/all_probes/stpeters_cross/stpeters_bottom.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_bottom.png" ;
	x3d:frontUrl "../resources/images/all_probes/stpeters_cross/stpeters_front.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_front.png" ;
	x3d:leftUrl "../resources/images/all_probes/stpeters_cross/stpeters_left.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_left.png" ;
	x3d:rightUrl "../resources/images/all_probes/stpeters_cross/stpeters_right.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_right.png" ;
	x3d:topUrl "../resources/images/all_probes/stpeters_cross/stpeters_top.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_top.png" ;
	x3d:skyColor "0 0 0" ;
	x3d:transparency "0" ;
	x3d:containerField "children" .
:transform rdf:type owl:NamedIndividual , x3d:Transform ;
	x3d:center "0 0 0" ;
	x3d:rotation "0 0 1 0" ;
	x3d:scale "1 1 1" ;
	x3d:scaleOrientation "0 0 1 0" ;
	x3d:translation "0 0 0" ;
	x3d:bboxCenter "0 0 0" ;
	x3d:bboxSize "-1 -1 -1" ;
	x3d:containerField "children" .
:transform x3d:hasShape :Shape-anonymous .
:Shape-anonymous rdf:type owl:NamedIndividual , x3d:Shape ;
	x3d:containerField "children" ;
	x3d:bboxCenter "0 0 0" ;
	x3d:bboxSize "-1 -1 -1" .
:Appearance-anonymous rdf:type owl:NamedIndividual , x3d:Appearance ;
	x3d:containerField "appearance" .
:Material-anonymous rdf:type owl:NamedIndividual , x3d:Material ;
	x3d:diffuseColor ".7 .7 .7" ;
	x3d:specularColor ".5 .5 .5" ;
	x3d:ambientIntensity "0.2" ;
	x3d:emissiveColor "0 0 0" ;
	x3d:shininess "0.2" ;
	x3d:transparency "0" ;
	x3d:containerField "material" .
:ComposedCubeMapTexture-anonymous rdf:type owl:NamedIndividual , x3d:ComposedCubeMapTexture ;
	x3d:containerField "texture" .
:ImageTexture-anonymous rdf:type owl:NamedIndividual , x3d:ImageTexture ;
	x3d:url "../resources/images/all_probes/stpeters_cross/stpeters_back.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_back.png" ;
	x3d:containerField "back" ;
	x3d:repeatS "true" ;
	x3d:repeatT "true" .
:ImageTexture-anonymous rdf:type owl:NamedIndividual , x3d:ImageTexture ;
	x3d:url "../resources/images/all_probes/stpeters_cross/stpeters_bottom.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_bottom.png" ;
	x3d:containerField "bottom" ;
	x3d:repeatS "true" ;
	x3d:repeatT "true" .
:ImageTexture-anonymous rdf:type owl:NamedIndividual , x3d:ImageTexture ;
	x3d:url "../resources/images/all_probes/stpeters_cross/stpeters_front.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_front.png" ;
	x3d:containerField "front" ;
	x3d:repeatS "true" ;
	x3d:repeatT "true" .
:ImageTexture-anonymous rdf:type owl:NamedIndividual , x3d:ImageTexture ;
	x3d:url "../resources/images/all_probes/stpeters_cross/stpeters_left.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_left.png" ;
	x3d:containerField "left" ;
	x3d:repeatS "true" ;
	x3d:repeatT "true" .
:ImageTexture-anonymous rdf:type owl:NamedIndividual , x3d:ImageTexture ;
	x3d:url "../resources/images/all_probes/stpeters_cross/stpeters_right.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_right.png" ;
	x3d:containerField "right" ;
	x3d:repeatS "true" ;
	x3d:repeatT "true" .
:ImageTexture-anonymous rdf:type owl:NamedIndividual , x3d:ImageTexture ;
	x3d:url "../resources/images/all_probes/stpeters_cross/stpeters_top.png https://coderextreme.net/X3DJSONLD/images/all_probes/stpeters_cross/stpeters_top.png" ;
	x3d:containerField "top" ;
	x3d:repeatS "true" ;
	x3d:repeatT "true" .
:shader rdf:type owl:NamedIndividual , x3d:ComposedShader ;
	x3d:language "GLSL" ;
	x3d:containerField "shaders" .
:shader x3d:hasfield :field-anonymous .
:field-anonymous rdf:type owl:NamedIndividual , x3d:field ;
	x3d:name "cube" ;
	x3d:accessType "inputOutput" ;
	x3d:value "0" .
:shader x3d:hasfield :field-anonymous .
:field-anonymous rdf:type owl:NamedIndividual , x3d:field ;
	x3d:name "chromaticDispertion" ;
	x3d:accessType "inputOutput" ;
	x3d:value "0.98 1.0 1.033" .
:shader x3d:hasfield :field-anonymous .
:field-anonymous rdf:type owl:NamedIndividual , x3d:field ;
	x3d:name "bias" ;
	x3d:accessType "inputOutput" ;
	x3d:value "0.5" .
:shader x3d:hasfield :field-anonymous .
:field-anonymous rdf:type owl:NamedIndividual , x3d:field ;
	x3d:name "scale" ;
	x3d:accessType "inputOutput" ;
	x3d:value "0.5" .
:shader x3d:hasfield :field-anonymous .
:field-anonymous rdf:type owl:NamedIndividual , x3d:field ;
	x3d:name "power" ;
	x3d:accessType "inputOutput" ;
	x3d:value "2" .
:shader x3d:hasShaderPart :ShaderPart-anonymous .
:ShaderPart-anonymous rdf:type owl:NamedIndividual , x3d:ShaderPart ;
	x3d:url "../shaders/x3dom.vs https://coderextreme.net/X3DJSONLD/src/main/shaders/x3dom.vs" ;
	x3d:containerField "parts" .
:shader x3d:hasShaderPart :ShaderPart-anonymous .
:ShaderPart-anonymous rdf:type owl:NamedIndividual , x3d:ShaderPart ;
	x3d:url "../shaders/pc_bubbles.fs https://coderextreme.net/X3DJSONLD/src/main/shaders/pc_bubbles.fs" ;
	x3d:containerField "parts" .
:Orbit rdf:type owl:NamedIndividual , x3d:IndexedFaceSet ;
	x3d:convex "false" ;
	x3d:creaseAngle "0" ;
	x3d:ccw "true" ;
	x3d:colorPerVertex "true" ;
	x3d:normalPerVertex "true" ;
	x3d:solid "true" ;
	x3d:containerField "geometry" .
:Orbit x3d:hasCoordinate :OrbitCoordinates .
:OrbitCoordinates rdf:type owl:NamedIndividual , x3d:Coordinate ;
	x3d:containerField "coord" .
:OrbitScript rdf:type owl:NamedIndividual , x3d:Script ;
	x3d:directOutput "false" ;
	x3d:mustEvaluate "false" ;
	x3d:containerField "children" .

            :OrbitScript x3d:hasfield :field-anonymous .
:field-anonymous rdf:type owl:NamedIndividual , x3d:field ;
	x3d:accessType "inputOnly" ;
	x3d:name "set_fraction" .

            :OrbitScript x3d:hasfield :field-anonymous .
:field-anonymous rdf:type owl:NamedIndividual , x3d:field ;
	x3d:accessType "inputOutput" ;
	x3d:name "coordinates" .

            :OrbitScript x3d:hasfield :field-anonymous .
:field-anonymous rdf:type owl:NamedIndividual , x3d:field ;
	x3d:accessType "outputOnly" ;
	x3d:name "coordIndexes" .



ecmascript:

var e = 5;
var f = 5;
var g = 5;
var h = 5;

function initialize() {
     var resolution = 100;
     updateCoordinates(resolution);
     var cis = [];
     for ( i = 0; i < resolution-1; i++) {
     	for ( j = 0; j < resolution-1; j++) {
	     cis.push(i*resolution+j);
	     cis.push(i*resolution+j+1);
	     cis.push((i+1)*resolution+j+1);
	     cis.push((i+1)*resolution+j);
	     cis.push(-1);
	}
    }
    coordIndexes = new MFInt32(cis);
}

function updateCoordinates(resolution) {
     var theta = 0.0;
     var phi = 0.0;
     var delta = (2 * 3.141592653) / (resolution-1);
     var crds = [];
     for ( i = 0; i < resolution; i++) {
     	for ( j = 0; j < resolution; j++) {
		var rho = e + f * Math.cos(g * theta) * Math.cos(h * phi);
		crds.push(new SFVec3f(
			rho * Math.cos(phi) * Math.cos(theta),
			rho * Math.cos(phi) * Math.sin(theta),
			rho * Math.sin(phi)
		));
		theta += delta;
	}
	phi += delta;
     }
     coordinates = new MFVec3f(crds);
}

function set_fraction(fraction, eventTime) {
	var choice = Math.floor(Math.random() * 4);
	switch (choice) {
	case 0:
		e += Math.floor(Math.random() * 2) * 2 - 1;
		break;
	case 1:
		f += Math.floor(Math.random() * 2) * 2 - 1;
		break;
	case 2:
		g += Math.floor(Math.random() * 2) * 2 - 1;
		break;
	case 3:
		h += Math.floor(Math.random() * 2) * 2 - 1;
		break;
	}
	if (f < 1) {
		f = 10;
	}
	if (g < 1) {
		g = 4;
	}
	if (h < 1) {
		h = 4;
	}
	var resolution = 100;
	updateCoordinates(resolution);
}
      :Clock rdf:type owl:NamedIndividual , x3d:TimeSensor ;
	x3d:cycleInterval "16" ;
	x3d:loop "true" ;
	x3d:enabled "true" ;
	x3d:startTime "0" ;
	x3d:stopTime "0" ;
	x3d:pauseTime "0" ;
	x3d:resumeTime "0" ;
	x3d:containerField "children" .
:ROUTE-anonymous rdf:type owl:NamedIndividual , x3d:ROUTE ;
	x3d:fromField "coordIndexes" ;
	x3d:fromNode "OrbitScript" ;
	x3d:toField "set_coordIndex" ;
	x3d:toNode "Orbit" .
:ROUTE-anonymous rdf:type owl:NamedIndividual , x3d:ROUTE ;
	x3d:fromField "coordinates" ;
	x3d:fromNode "OrbitScript" ;
	x3d:toField "set_point" ;
	x3d:toNode "OrbitCoordinates" .
:ROUTE-anonymous rdf:type owl:NamedIndividual , x3d:ROUTE ;
	x3d:fromField "fraction_changed" ;
	x3d:fromNode "Clock" ;
	x3d:toField "set_fraction" ;
	x3d:toNode "OrbitScript" .
