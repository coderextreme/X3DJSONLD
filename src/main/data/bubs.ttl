@prefix : <https://coderextreme.net/X3DJSONLD/bubs.ttl#> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <http://schema.org/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix x3d: <https://www.web3d.org/semantics/ontologies/X3dOntology4.0#> .

:Scene rdf:type owl:NamedIndividual, x3d:Scene .
:NavigationInfo_2 rdf:type owl:NamedIndividual, x3d:NavigationInfo ;
  x3d:type "EXAMINE" .
:Viewpoint_2 rdf:type owl:NamedIndividual, x3d:Viewpoint ;
  x3d:position "0 0 4" ;
  x3d:orientation "1 0 0 0" ;
  x3d:description "Bubbles in action" .
:Background_2 rdf:type owl:NamedIndividual, x3d:Background ;
  x3d:backUrl "../resources/images/BK.png https://coderextreme.net/X3DJSONLD/images/BK.png" ;
  x3d:bottomUrl "../resources/images/BT.png https://coderextreme.net/X3DJSONLD/images/BT.png" ;
  x3d:frontUrl "../resources/images/FR.png https://coderextreme.net/X3DJSONLD/images/FR.png" ;
  x3d:leftUrl "../resources/images/LF.png https://coderextreme.net/X3DJSONLD/images/LF.png" ;
  x3d:rightUrl "../resources/images/RT.png https://coderextreme.net/X3DJSONLD/images/RT.png" ;
  x3d:topUrl "../resources/images/TP.png https://coderextreme.net/X3DJSONLD/images/TP.png" .
:ProtoDeclare_2 rdf:type owl:NamedIndividual, x3d:ProtoDeclare ;
  x3d:name "Bubble" .
:ProtoBody_2_4 rdf:type owl:NamedIndividual, x3d:ProtoBody .
:transform rdf:type owl:NamedIndividual, x3d:Transform .
:transform x3d:hasShape :Shape_2_4_1_1 .
:Shape_2_4_1_1 rdf:type owl:NamedIndividual, x3d:Shape .
:Sphere_2_4_1_1_1 rdf:type owl:NamedIndividual, x3d:Sphere ;
  x3d:radius "0.25" .
:Appearance_2_4_1_1_1 rdf:type owl:NamedIndividual, x3d:Appearance .
:Material_2_4_1_1_1_2 rdf:type owl:NamedIndividual, x3d:Material ;
  x3d:diffuseColor "1 0 0" ;
  x3d:transparency "0.2" .
:transform x3d:hasScript :bounce .
:bounce rdf:type owl:NamedIndividual, x3d:Script .
:bounce x3d:hasfield :field_2_4_1_1_2 .
:field_2_4_1_1_2 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "scale" ;
  x3d:accessType "inputOutput" ;
  x3d:type "SFVec3f" ;
  x3d:value "1 1 1" .

				:bounce x3d:hasfield :field_2_4_1_1_2 .
:field_2_4_1_1_2 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "translation" ;
  x3d:accessType "inputOutput" ;
  x3d:type "SFVec3f" ;
  x3d:value "0 0 0" .

				:bounce x3d:hasfield :field_2_4_1_1_2 .
:field_2_4_1_1_2 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "velocity" ;
  x3d:accessType "inputOutput" ;
  x3d:type "SFVec3f" ;
  x3d:value "0 0 0" .

				:bounce x3d:hasfield :field_2_4_1_1_2 .
:field_2_4_1_1_2 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "scalvel" ;
  x3d:accessType "inputOutput" ;
  x3d:type "SFVec3f" ;
  x3d:value "0 0 0" .

				:bounce x3d:hasfield :field_2_4_1_1_2 .
:field_2_4_1_1_2 rdf:type owl:NamedIndividual, x3d:field ;
  x3d:name "set_fraction" ;
  x3d:accessType "inputOnly" ;
  x3d:type "SFFloat" .

ecmascript:
function initialize() {
    velocity = new SFVec3f(Math.random() * 0.25 - 0.125, Math.random() * 0.25 - 0.125, Math.random() * 0.25 - 0.125);

    scalvel = new SFVec3f(Math.random() * 0.4, Math.random() * 0.4, Math.random() * 0.4);
}

function set_fraction(value) {
    translation = new SFVec3f(	translation.x + velocity.x, translation.y + velocity.y, translation.z + velocity.z);
    scale = new SFVec3f(scale.x + scalvel.x, scale.y + scalvel.y, scale.z + scalvel.z);
    // if you get to far away or too big, explode
    if ( Math.abs(translation.x) > 256) {
	translation.x = 0;
	initialize();
    }
    if ( Math.abs(translation.y) > 256) {
	translation.y = 0;
	initialize();
    }
    if ( Math.abs(translation.z) > 256) {
	translation.z = 0;
	initialize();
    }
    if (Math.abs(scale.x) > 20) {
	scale.x = scale.x/20;
	translation.x = 0;
	initialize();
    }
    if (Math.abs(scale.y) > 20) {
	scale.y = scale.y/20;
	translation.y = 0;
	initialize();
    }
    if (Math.abs(scale.z) > 20) {
	scale.z = scale.z/20;
	translation.z = 0;
	initialize();
    }
}

			:transform x3d:hasTimeSensor :bubbleClock .
:bubbleClock rdf:type owl:NamedIndividual, x3d:TimeSensor ;
  x3d:cycleInterval "10" ;
  x3d:loop "true" .
:transform x3d:hasROUTE :ROUTE_2_4_1_1 .
:ROUTE_2_4_1_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "bounce" ;
  x3d:fromField "translation_changed" ;
  x3d:toNode "transform" ;
  x3d:toField "set_translation" .
:transform x3d:hasROUTE :ROUTE_2_4_1_1 .
:ROUTE_2_4_1_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "bounce" ;
  x3d:fromField "scale_changed" ;
  x3d:toNode "transform" ;
  x3d:toField "set_scale" .
:transform x3d:hasROUTE :ROUTE_2_4_1_1 .
:ROUTE_2_4_1_1 rdf:type owl:NamedIndividual, x3d:ROUTE ;
  x3d:fromNode "bubbleClock" ;
  x3d:fromField "fraction_changed" ;
  x3d:toNode "bounce" ;
  x3d:toField "set_fraction" .
:bubbleA rdf:type owl:NamedIndividual, x3d:ProtoInstance ;
  x3d:name "Bubble" .
:bubbleB rdf:type owl:NamedIndividual, x3d:ProtoInstance ;
  x3d:name "Bubble" .
:bubbleC rdf:type owl:NamedIndividual, x3d:ProtoInstance ;
  x3d:name "Bubble" .
:bubbleD rdf:type owl:NamedIndividual, x3d:ProtoInstance ;
  x3d:name "Bubble" .
